/**
 * Bundled by jsDelivr using Rollup v2.79.1 and Terser v5.17.1.
 * Original file: /npm/regl-scatterplot@1.7.1/dist/regl-scatterplot.esm.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
import e from "./pub-sub-es-2-0-2.js";;import t from "./regl-2-1-0.js";;var n,o="undefined"!=typeof Float32Array?Float32Array:Array;function r(){var e=new o(16);return o!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function i(e){var t=new o(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function a(e,t){var n=t[0],o=t[1],r=t[2],i=t[3],a=t[4],s=t[5],l=t[6],c=t[7],d=t[8],u=t[9],p=t[10],m=t[11],h=t[12],f=t[13],y=t[14],g=t[15],v=n*s-o*a,w=n*l-r*a,x=n*c-i*a,b=o*l-r*s,S=o*c-i*s,E=r*c-i*l,C=d*f-u*h,P=d*y-p*h,M=d*g-m*h,A=u*y-p*f,I=u*g-m*f,R=p*g-m*y,T=v*R-w*I+x*A+b*M-S*P+E*C;return T?(T=1/T,e[0]=(s*R-l*I+c*A)*T,e[1]=(r*I-o*R-i*A)*T,e[2]=(f*E-y*S+g*b)*T,e[3]=(p*S-u*E-m*b)*T,e[4]=(l*M-a*R-c*P)*T,e[5]=(n*R-r*M+i*P)*T,e[6]=(y*x-h*E-g*w)*T,e[7]=(d*E-p*x+m*w)*T,e[8]=(a*I-s*M+c*C)*T,e[9]=(o*M-n*I-i*C)*T,e[10]=(h*S-f*x+g*v)*T,e[11]=(u*x-d*S-m*v)*T,e[12]=(s*P-a*A-l*C)*T,e[13]=(n*A-o*P+r*C)*T,e[14]=(f*w-h*b-y*v)*T,e[15]=(d*b-u*w+p*v)*T,e):null}function s(e,t,n){var o=t[0],r=t[1],i=t[2],a=t[3],s=t[4],l=t[5],c=t[6],d=t[7],u=t[8],p=t[9],m=t[10],h=t[11],f=t[12],y=t[13],g=t[14],v=t[15],w=n[0],x=n[1],b=n[2],S=n[3];return e[0]=w*o+x*s+b*u+S*f,e[1]=w*r+x*l+b*p+S*y,e[2]=w*i+x*c+b*m+S*g,e[3]=w*a+x*d+b*h+S*v,w=n[4],x=n[5],b=n[6],S=n[7],e[4]=w*o+x*s+b*u+S*f,e[5]=w*r+x*l+b*p+S*y,e[6]=w*i+x*c+b*m+S*g,e[7]=w*a+x*d+b*h+S*v,w=n[8],x=n[9],b=n[10],S=n[11],e[8]=w*o+x*s+b*u+S*f,e[9]=w*r+x*l+b*p+S*y,e[10]=w*i+x*c+b*m+S*g,e[11]=w*a+x*d+b*h+S*v,w=n[12],x=n[13],b=n[14],S=n[15],e[12]=w*o+x*s+b*u+S*f,e[13]=w*r+x*l+b*p+S*y,e[14]=w*i+x*c+b*m+S*g,e[15]=w*a+x*d+b*h+S*v,e}function l(e,t){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=t[0],e[13]=t[1],e[14]=t[2],e[15]=1,e}function c(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function d(e,t,n){var o=t[0],r=t[1],i=t[2],a=t[3];return e[0]=n[0]*o+n[4]*r+n[8]*i+n[12]*a,e[1]=n[1]*o+n[5]*r+n[9]*i+n[13]*a,e[2]=n[2]*o+n[6]*r+n[10]*i+n[14]*a,e[3]=n[3]*o+n[7]*r+n[11]*i+n[15]*a,e}Math.hypot||(Math.hypot=function(){for(var e=0,t=arguments.length;t--;)e+=arguments[t]*arguments[t];return Math.sqrt(e)}),n=new o(4),o!=Float32Array&&(n[0]=0,n[1]=0,n[2]=0,n[3]=0),function(){var e=function(){var e=new o(2);return o!=Float32Array&&(e[0]=0,e[1]=0),e}()}();const u=(e=[0,0],t=1,n=0,o=[0,0],i=[[0,1/0],[0,1/0]],u=[[-1/0,1/0],[-1/0,1/0]])=>{const p=new Float32Array(16),m=new Float32Array(16),h=new Float32Array(16);let f=r(),y=[...o.slice(0,2),0,1];const g=Array.isArray(i[0])?[...i[0]]:[...i],v=Array.isArray(i[0])?[...i[1]]:[...i],w=Array.isArray(u[0])?[...u[0]]:[...u],x=Array.isArray(u[0])?[...u[1]]:[...u],b=()=>function(e,t){var n=t[0],o=t[1],r=t[2],i=t[4],a=t[5],s=t[6],l=t[8],c=t[9],d=t[10];return e[0]=Math.hypot(n,o,r),e[1]=Math.hypot(i,a,s),e[2]=Math.hypot(l,c,d),e}(p,f).slice(0,2),S=()=>{const e=b();return Math.min(e[0],e[1])},E=()=>{const e=b();return Math.max(e[0],e[1])},C=([e=0,t=0]=[],n=1,o=0)=>{f=r(),P([-e,-t]),A(o),M(1/n)},P=([e=0,t=0]=[])=>{p[0]=e,p[1]=t,p[2]=0;const n=l(m,p);s(f,n,f)},M=(e,t)=>{const n=Array.isArray(e);let o=n?e[0]:e,r=n?e[1]:e;if(o<=0||r<=0||1===o&&1===r)return;const i=b(),d=i[0]*o,u=i[1]*r;if(o=Math.max(g[0],Math.min(d,g[1]))/i[0],r=Math.max(v[0],Math.min(u,v[1]))/i[1],1===o&&1===r)return;p[0]=o,p[1]=r,p[2]=1;const w=c(m,p),x=t?[...t,0]:y,S=l(p,x);s(f,S,s(f,w,s(f,a(h,S),f)))},A=e=>{const t=r();!function(e,t,n){var o,r,i,a=n[0],s=n[1],l=n[2],c=Math.hypot(a,s,l);c<1e-6||(a*=c=1/c,s*=c,l*=c,o=Math.sin(t),i=1-(r=Math.cos(t)),e[0]=a*a*i+r,e[1]=s*a*i+l*o,e[2]=l*a*i-s*o,e[3]=0,e[4]=a*s*i-l*o,e[5]=s*s*i+r,e[6]=l*s*i+a*o,e[7]=0,e[8]=a*l*i+s*o,e[9]=s*l*i-a*o,e[10]=l*l*i+r,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1)}(t,e,[0,0,1]),s(f,t,f)},I=e=>{!e||e.length<16||(f=e)};return C(e,t,n),{get translation(){return function(e,t){return e[0]=t[12],e[1]=t[13],e[2]=t[14],e}(p,f).slice(0,2)},get target(){return d(p,y,a(h,f)).slice(0,2)},get scaling(){return b()},get minScaling(){return S()},get maxScaling(){return E()},get scaleBounds(){return[[...g],[...v]]},get translationBounds(){return[[...w],[...x]]},get distance(){return(()=>{const e=b();return[1/e[0],1/e[1]]})()},get minDistance(){return 1/S()},get maxDistance(){return 1/E()},get rotation(){return Math.acos(f[0]/E())},get view(){return f},get viewCenter(){return y.slice(0,2)},lookAt:C,translate:P,pan:P,rotate:A,scale:M,zoom:M,reset:()=>{C(e,t,n)},set:(...e)=>(console.warn("`set()` is deprecated. Please use `setView()` instead."),I(...e)),setScaleBounds:e=>{const t=Array.isArray(e[0]);g[0]=t?e[0][0]:e[0],g[1]=t?e[0][1]:e[1],v[0]=t?e[1][0]:e[0],v[1]=t?e[1][1]:e[1]},setTranslationBounds:e=>{const t=Array.isArray(e[0]);w[0]=t?e[0][0]:e[0],w[1]=t?e[0][1]:e[1],x[0]=t?e[1][0]:e[0],x[1]=t?e[1][1]:e[1]},setView:I,setViewCenter:e=>{y=[...e.slice(0,2),0,1]}}},p=["pan","rotate"],m={alt:"altKey",cmd:"metaKey",ctrl:"ctrlKey",meta:"metaKey",shift:"shiftKey"},h=(e,{distance:t=1,target:n=[0,0],rotation:o=0,isNdc:r=!0,isFixed:i=!1,isPan:a=!0,isPanInverted:s=[!1,!0],panSpeed:l=1,isRotate:c=!0,rotateSpeed:d=1,defaultMouseDownMoveAction:h="pan",mouseDownMoveModKey:f="alt",isZoom:y=!0,zoomSpeed:g=1,viewCenter:v,scaleBounds:w,translationBounds:x,onKeyDown:b=(()=>{}),onKeyUp:S=(()=>{}),onMouseDown:E=(()=>{}),onMouseUp:C=(()=>{}),onMouseMove:P=(()=>{}),onWheel:M=(()=>{})}={})=>{let A=u(n,t,o,v,w,x),I=0,R=0,T=0,O=0,L=0,B=0,$=!1,z=0,D=1,k=1,F=1,N=!1,j=!1,_=!1,V="pan"===h,W=a,Z=a,q=s,G=s,H=y,K=y;const X=()=>{W=Array.isArray(a)?Boolean(a[0]):a,Z=Array.isArray(a)?Boolean(a[1]):a,q=Array.isArray(s)?Boolean(s[0]):s,G=Array.isArray(s)?Boolean(s[1]):s,H=Array.isArray(y)?Boolean(y[0]):y,K=Array.isArray(y)?Boolean(y[1]):y};X();const Y=r?e=>e/D*2*F:e=>e,U=r?e=>e/k*2:e=>-e,J=r?e=>(e/D*2-1)*F:e=>e,Q=r?e=>1-e/k*2:e=>e,ee=()=>{const t=e.getBoundingClientRect();D=t.width,k=t.height,F=D/k},te=e=>{_=!1,S(e)},ne=e=>{_=e[m[f]],b(e)},oe=e=>{$=!1,C(e)},re=e=>{$=1===e.buttons,E(e)},ie=void 0!==document.createEvent("MouseEvent").offsetX?e=>{T=e.offsetX,O=e.offsetY}:t=>{const n=e.getBoundingClientRect();T=t.clientX-n.left,O=t.clientY-n.top},ae=e=>{I=e.clientX,R=e.clientY},se=e=>{ae(e),P(e)},le=e=>{if(H||K){e.preventDefault(),ae(e),ie(e);const t=1===e.deltaMode?12:1;z+=t*(e.deltaY||e.deltaX||0)}M(e)};window.addEventListener("keydown",ne,{passive:!0}),window.addEventListener("keyup",te,{passive:!0}),e.addEventListener("mousedown",re,{passive:!0}),window.addEventListener("mouseup",oe,{passive:!0}),window.addEventListener("mousemove",se,{passive:!0}),e.addEventListener("wheel",le,{passive:!1}),A.config=({defaultMouseDownMoveAction:e=null,isFixed:t=null,isPan:n=null,isPanInverted:o=null,isRotate:r=null,isZoom:u=null,panSpeed:v=null,rotateSpeed:w=null,zoomSpeed:x=null,mouseDownMoveModKey:b=null}={})=>{h=null!==e&&p.includes(e)?e:h,V="pan"===h,i=null!==t?t:i,a=null!==n?n:a,s=null!==o?o:s,c=null!==r?r:c,y=null!==u?u:y,l=+v>0?v:l,d=+w>0?w:d,g=+x>0?x:g,X(),f=null!==b&&Object.keys(m).includes(b)?b:f},A.dispose=()=>{A=void 0,window.removeEventListener("keydown",ne),window.removeEventListener("keyup",te),e.removeEventListener("mousedown",re),window.removeEventListener("mouseup",oe),window.removeEventListener("mousemove",se),e.removeEventListener("wheel",le)},A.refresh=ee,A.tick=()=>{if(i){const e=j;return j=!1,e}N=!1;const e=I,t=R;if((W||Z)&&$&&(V&&!_||!V&&_)){const n=W?Y(l*(q?L-e:e-L)):0,o=Z?U(l*(G?B-t:t-B)):0;0===n&&0===o||(A.pan([n,o]),N=!0)}if((H||K)&&z){const e=g*Math.exp(z/k),t=J(T),n=Q(O);A.scale([H?1/e:1,K?1/e:1],[t,n]),N=!0}if(c&&$&&(V&&_||!V&&!_)&&Math.abs(L-e)+Math.abs(B-t)>0){const n=D/2,o=k/2,r=L-n,i=o-B,a=e-n,s=o-t,l=function(e,t){var n=e[0],o=e[1],r=t[0],i=t[1],a=Math.sqrt(n*n+o*o)*Math.sqrt(r*r+i*i),s=a&&(n*r+o*i)/a;return Math.acos(Math.min(Math.max(s,-1),1))}([r,i],[a,s]),c=r*s-a*i;A.rotate(d*l*Math.sign(c)),N=!0}z=0,L=e,B=t;const n=N||j;return j=!1,n};const ce=e=>function(){e.apply(null,arguments),j=!0};return A.lookAt=ce(A.lookAt),A.translate=ce(A.translate),A.pan=ce(A.pan),A.rotate=ce(A.rotate),A.scale=ce(A.scale),A.zoom=ce(A.zoom),A.reset=ce(A.reset),A.set=ce(A.set),A.setScaleBounds=ce(A.setScaleBounds),A.setTranslationBounds=ce(A.setTranslationBounds),A.setView=ce(A.setView),A.setViewCenter=ce(A.setViewCenter),ee(),A};function f(e,t,n,o,r,i){if(r-o<=n)return;const a=o+r>>1;y(e,t,a,o,r,i%2),f(e,t,n,o,a-1,i+1),f(e,t,n,a+1,r,i+1)}function y(e,t,n,o,r,i){for(;r>o;){if(r-o>600){const a=r-o+1,s=n-o+1,l=Math.log(a),c=.5*Math.exp(2*l/3),d=.5*Math.sqrt(l*c*(a-c)/a)*(s-a/2<0?-1:1);y(e,t,n,Math.max(o,Math.floor(n-s*c/a+d)),Math.min(r,Math.floor(n+(a-s)*c/a+d)),i)}const a=t[2*n+i];let s=o,l=r;for(g(e,t,o,n),t[2*r+i]>a&&g(e,t,o,r);s<l;){for(g(e,t,s,l),s++,l--;t[2*s+i]<a;)s++;for(;t[2*l+i]>a;)l--}t[2*o+i]===a?g(e,t,o,l):(l++,g(e,t,l,r)),l<=n&&(o=l+1),n<=l&&(r=l-1)}}function g(e,t,n,o){v(e,n,o),v(t,2*n,2*o),v(t,2*n+1,2*o+1)}function v(e,t,n){const o=e[t];e[t]=e[n],e[n]=o}function w(e,t,n,o){const r=e-n,i=t-o;return r*r+i*i}const x=e=>e[0],b=e=>e[1];class S{constructor(e,t=x,n=b,o=64,r=Float64Array){this.nodeSize=o,this.points=e;const i=e.length<65536?Uint16Array:Uint32Array,a=this.ids=new i(e.length),s=this.coords=new r(2*e.length);for(let o=0;o<e.length;o++)a[o]=o,s[2*o]=t(e[o]),s[2*o+1]=n(e[o]);f(a,s,o,0,a.length-1,0)}range(e,t,n,o){return function(e,t,n,o,r,i,a){const s=[0,e.length-1,0],l=[];let c,d;for(;s.length;){const u=s.pop(),p=s.pop(),m=s.pop();if(p-m<=a){for(let a=m;a<=p;a++)c=t[2*a],d=t[2*a+1],c>=n&&c<=r&&d>=o&&d<=i&&l.push(e[a]);continue}const h=Math.floor((m+p)/2);c=t[2*h],d=t[2*h+1],c>=n&&c<=r&&d>=o&&d<=i&&l.push(e[h]);const f=(u+1)%2;(0===u?n<=c:o<=d)&&(s.push(m),s.push(h-1),s.push(f)),(0===u?r>=c:i>=d)&&(s.push(h+1),s.push(p),s.push(f))}return l}(this.ids,this.coords,e,t,n,o,this.nodeSize)}within(e,t,n){return function(e,t,n,o,r,i){const a=[0,e.length-1,0],s=[],l=r*r;for(;a.length;){const c=a.pop(),d=a.pop(),u=a.pop();if(d-u<=i){for(let r=u;r<=d;r++)w(t[2*r],t[2*r+1],n,o)<=l&&s.push(e[r]);continue}const p=Math.floor((u+d)/2),m=t[2*p],h=t[2*p+1];w(m,h,n,o)<=l&&s.push(e[p]);const f=(c+1)%2;(0===c?n-r<=m:o-r<=h)&&(a.push(u),a.push(p-1),a.push(f)),(0===c?n+r>=m:o+r>=h)&&(a.push(p+1),a.push(d),a.push(f))}return s}(this.ids,this.coords,e,t,n,this.nodeSize)}}const{push:E,splice:C}=Array.prototype,P=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),M=Float32Array.BYTES_PER_ELEMENT,A={duplicate(e,t=1,n=1){const o=[],r=new Array(2*t);for(let i=0,a=e.length/t;i<a;i++){const a=i*t;for(let o=0;o<t;o++){const i=e[a+o];r[o]=i,r[o+t]=i*n}E.apply(o,r)}return o},mapElement(e,t,n,o){for(let r=0,i=e.length/n;r<i;r++){const i=t+r*n;e[i]=o(e[i],i,r)}return e},copyElement(e,t,n,o){const r=new Array(o),i=t*o;for(let t=0;t<o;t++)r[t]=e[i+t];return C.call(e,n*o,0,...r),e},increaseStride(e,t,n,o=0){const r=[],i=new Array(n).fill(o);for(let n=0,o=e.length/t;n<o;n++){const o=n*t;for(let n=0;n<t;n++)i[n]=e[o+n];E.apply(r,i)}return r}};var I=(e,{projection:t=P,model:n=P,view:o=P,points:r=[],colorIndices:i=[],color:a=[.8,.5,0,1],opacity:l=null,opacities:c=[],width:d=1,widths:u=[],miter:p=1,is2d:m=!1,zPos2d:h=0}={})=>{if(!e)return void console.error("Regl instance is undefined.");const f=new Float32Array(16);let y,g,v,w,x,b,S,E,C,I,R,T,O,L,B,$,z,D,k=m?2:3;const F=()=>+(c.length===g||null!==l),N=()=>{I=e.buffer(),R=e.buffer(),T=e.buffer(),B=e.buffer(),$={prevPosition:{buffer:()=>I,offset:0,stride:3*M},currPosition:{buffer:()=>I,offset:3*M*2,stride:3*M},nextPosition:{buffer:()=>I,offset:3*M*4,stride:3*M},opacity:{buffer:()=>R,offset:2*M,stride:M},offsetScale:{buffer:()=>T,offset:2*M,stride:M},colorIndex:{buffer:()=>B,offset:2*M,stride:M}},z=e.elements(),D=e({attributes:$,depth:{enable:!m},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},uniforms:{projectionViewModel:(e,t)=>{const n=e.projection||t.projection,o=e.model||t.model,r=e.view||t.view;return s(f,n,s(f,r,o))},aspectRatio:({viewportWidth:e,viewportHeight:t})=>e/t,colorTex:()=>O,colorTexRes:()=>L,colorTexEps:()=>.5/L,pixelRatio:({pixelRatio:e})=>e,width:({pixelRatio:e,viewportHeight:t})=>d/t*e,useOpacity:F,useColorOpacity:()=>+!F(),miter:p},elements:()=>z,vert:"\nuniform mat4 projectionViewModel;\nuniform float aspectRatio;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform float width;\nuniform float useOpacity;\nuniform float useColorOpacity;\nuniform int miter;\n\nattribute vec3 prevPosition;\nattribute vec3 currPosition;\nattribute vec3 nextPosition;\nattribute float opacity;\nattribute float offsetScale;\nattribute float colorIndex;\n\nvarying vec4 color;\n\nvoid main() {\n  vec2 aspectVec = vec2(aspectRatio, 1.0);\n  vec4 prevProjected = projectionViewModel * vec4(prevPosition, 1.0);\n  vec4 currProjected = projectionViewModel * vec4(currPosition, 1.0);\n  vec4 nextProjected = projectionViewModel * vec4(nextPosition, 1.0);\n\n  // get 2D screen space with W divide and aspect correction\n  vec2 prevScreen = prevProjected.xy / prevProjected.w * aspectVec;\n  vec2 currScreen = currProjected.xy / currProjected.w * aspectVec;\n  vec2 nextScreen = nextProjected.xy / nextProjected.w * aspectVec;\n\n  // starting point uses (next - current)\n  vec2 dir = vec2(0.0);\n  if (currScreen == prevScreen) {\n    dir = normalize(nextScreen - currScreen);\n  }\n  // ending point uses (current - previous)\n  else if (currScreen == nextScreen) {\n    dir = normalize(currScreen - prevScreen);\n  }\n  // somewhere in middle, needs a join\n  else {\n    // get directions from (C - B) and (B - A)\n    vec2 dirA = normalize((currScreen - prevScreen));\n    if (miter == 1) {\n      vec2 dirB = normalize((nextScreen - currScreen));\n      // now compute the miter join normal and length\n      vec2 tangent = normalize(dirA + dirB);\n      vec2 perp = vec2(-dirA.y, dirA.x);\n      vec2 miter = vec2(-tangent.y, tangent.x);\n      dir = tangent;\n    } else {\n      dir = dirA;\n    }\n  }\n\n  vec2 normal = vec2(-dir.y, dir.x) * width;\n  normal.x /= aspectRatio;\n  vec4 offset = vec4(normal * offsetScale, 0.0, 0.0);\n  gl_Position = currProjected + offset;\n\n  // Get color from texture\n  float colorRowIndex = floor((colorIndex + colorTexEps) / colorTexRes);\n  vec2 colorTexIndex = vec2(\n    (colorIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n  color.a = useColorOpacity * color.a + useOpacity * opacity;\n}",frag:"\nprecision mediump float;\nvarying vec4 color;\nvoid main() {\n  gl_FragColor = color;\n}"})},j=()=>{_(),N()},_=()=>{r=null,w=null,x=null,E=null,C=null,I.destroy(),T.destroy(),z.destroy()},V=(e,t)=>{const n=t.flat(2);return n.length===g?n:n.length===y?v.map(((e,t)=>Array(e).fill(n[t]))).flat():e},W=(e=[],{colorIndices:t=i,opacities:n=c,widths:o=u,is2d:a=m}={})=>{r=e,k=(m=a)?2:3,y=Array.isArray(r[0])?r.length:1,v=y>1?r.map((e=>Math.floor(e.length/k))):[Math.floor(r.length/k)],g=v.reduce(((e,t)=>e+t),0),i=V(i,t),c=V(c,n),u=V(u,o),r&&g>1?(()=>{1===y&&r.length%k>0&&console.warn(`The length of points (${g}) does not match the dimensions (${k}). Incomplete points are ignored.`),w=r.flat().slice(0,g*k),m&&(w=A.increaseStride(w,2,3,h)),i.length!==g&&(i=new Array(g).fill(0)),u.length!==g&&(u=new Array(g).fill(1));let e=i.slice(),t=c.length===g?c.slice():new Array(g).fill(+l),n=u.slice(),o=0;v.forEach((r=>{const i=o+r-1;A.copyElement(w,i,i,3),A.copyElement(w,o,o,3),A.copyElement(e,i,i,1),A.copyElement(e,o,o,1),A.copyElement(t,i,i,1),A.copyElement(t,o,o,1),A.copyElement(n,i,i,1),A.copyElement(n,o,o,1),o+=r+2})),x=new Float32Array(A.duplicate(w,3)),b=A.duplicate(e),S=A.duplicate(t),E=A.duplicate(n,1,-1),C=((e,t=[])=>{let n=0;return e.forEach((e=>{for(let o=0;o<e-1;o++){const e=n+2*o,r=e+1,i=e+2,a=e+3;t.push(e,r,i,i,r,a)}n+=2*(e+2)})),t})(v),I({usage:"dynamic",type:"float",length:x.length*M,data:x}),R({usage:"dynamic",type:"float",length:S.length*M,data:S}),T({usage:"dynamic",type:"float",length:E.length*M,data:E}),B({usage:"dynamic",type:"float",length:b.length*M,data:b}),z({primitive:"triangles",usage:"dynamic",type:C.length>65536?"uint32":"uint16",data:C})})():j()},Z=(e,t=-1)=>Array.isArray(e)?e.length&&!Array.isArray(e[0])?t+1:Z(e[0],++t):t,q=()=>{const t=0===Z(a)?[a]:a;L=Math.max(2,Math.ceil(Math.sqrt(t.length)));const n=new Uint8Array(L**2*4);t.forEach(((e,t)=>{n[4*t]=Math.min(255,Math.max(0,Math.round(255*e[0]))),n[4*t+1]=Math.min(255,Math.max(0,Math.round(255*e[1]))),n[4*t+2]=Math.min(255,Math.max(0,Math.round(255*e[2]))),n[4*t+3]=Number.isNaN(+e[3])?255:Math.min(255,Math.max(0,Math.round(255*e[3])))})),O=e.texture({data:n,shape:[L,L,4]})};return N(),q(),r&&r.length>1&&W(r),{clear:j,destroy:_,draw:({projection:e,model:i,view:a}={})=>{e&&(t=e),i&&(n=i),a&&(o=a),r&&r.length>1&&D({projection:t,model:n,view:o})},getPoints:()=>r,setPoints:W,getData:()=>({points:x,widths:E,opacities:S,colorIndices:b}),getBuffer:()=>({points:I,widths:T,opacities:R,colorIndices:B}),getStyle:()=>({color:a,miter:p,width:d}),setStyle:({color:e,opacity:t,miter:n,width:o}={})=>{e&&((e,t=l)=>{a=e,l=t,O&&O.destroy(),q()})(e,t),n&&(p=n),+o>0&&(d=o)}}};const R=e=>e<.5?4*e*e*e:(e-1)*(2*e-2)*(2*e-2)+1,T=e=>e,O=(e,t=(e=>e))=>{const n=[];for(let o=0;o<e;o++)n.push(t(o,e));return n},L=(e,...t)=>(t.forEach((t=>{const n=Object.keys(t).reduce(((e,n)=>(e[n]=Object.getOwnPropertyDescriptor(t,n),e)),{});Object.getOwnPropertySymbols(t).forEach((e=>{const o=Object.getOwnPropertyDescriptor(t,e);o.enumerable&&(n[e]=o)})),Object.defineProperties(e,n)})),e),B=(e,t)=>n=>L(n,{get[e](){return t}}),$=(e=1)=>new Promise((t=>{let n=0;const o=()=>requestAnimationFrame((()=>{n++,n<e?o():t()}));o()})),z=(e,t,n=null)=>{let o,r=0;n=null===n?t:n;const i=(...t)=>{clearTimeout(o),o=setTimeout((()=>{r>0&&(e(...t),r=0)}),n)};let a=!1;const s=(...n)=>{a?(r++,i(...n)):(e(...n),i(...n),a=!0,r=0,setTimeout((()=>{a=!1}),t))};return s.reset=()=>{a=!1},s.cancel=()=>{clearTimeout(o)},s.now=(...t)=>e(...t),s},D="auto",k=Float32Array.BYTES_PER_ELEMENT,F=["OES_texture_float","OES_element_index_uint","WEBGL_color_buffer_float","EXT_float_blend"],N={color:[0,0,0,0],depth:1},j="panZoom",_="lasso",V="rotate",W=[j,_,V],Z=j,q={cubicIn:e=>e*e*e,cubicInOut:R,cubicOut:e=>--e*e*e+1,linear:e=>e,quadIn:e=>e*e,quadInOut:e=>e<.5?2*e*e:(4-2*e)*e-1,quadOut:e=>e*(2-e)},G=R,H="continuous",K="categorical",X=[H,K],Y="deselect",U="lassoEnd",J=[Y,U],Q=[0,.666666667,1,1],ee=2,te=!1,ne=10,oe=3,re=U,ie=!1,ae=750,se=500,le=100,ce=250,de="lasso",ue="rotate",pe="merge",me=[de,ue,pe],he="alt",fe="cmd",ye="ctrl",ge="meta",ve="shift",we=[he,fe,ye,ge,ve],xe={[he]:ue,[ve]:de,[fe]:pe},be=D,Se=D,Ee=1,Ce=6,Pe=2,Me=2,Ae=null,Ie=2,Re=2,Te=null,Oe=null,Le=null,Be=.66,$e=null,ze=.15,De=25,ke=1,Fe=1,Ne=null,je=[.66,.66,.66,1],_e=[0,.55,1,1],Ve=[1,1,1,1],We=[0,0,0,1],Ze=null,qe=[.66,.66,.66,.2],Ge=[0,.55,1,1],He=[1,1,1,1],Ke=[0,0],Xe=new Float32Array([1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]),Ye=null,Ue=!1,Je=[1,1,1,.5],Qe=!0,et=!0,tt=!1,nt=100,ot=.002,rt="auto",it=!1,at=new Set(["z","valueZ","valueA","value1","category"]),st=new Set(["w","valueW","valueB","value2","value"]),lt=(e,t)=>!!e&&F.reduce(((n,o)=>e.hasExtension(o)?n:(t||console.warn(`WebGL: ${o} extension not supported. Scatterplot might not render properly`),!1)),!0),ct=e=>{const n=e.getContext("webgl",{antialias:!0,preserveDrawingBuffer:!0}),o=[];return F.forEach((e=>{n.getExtension(e)?o.push(e):console.warn(`WebGL: ${e} extension not supported. Scatterplot might not render properly`)})),t({gl:n,extensions:o})},dt=(e,t,n,o)=>Math.sqrt((e-n)**2+(t-o)**2),ut=(e,t=!1)=>e.replace(/^#?([a-f\d])([a-f\d])([a-f\d])$/i,((e,t,n,o)=>`#${t}${t}${n}${n}${o}${o}`)).substring(1).match(/.{2}/g).map((e=>parseInt(e,16)/255**t)),pt=(e,t,{minLength:n=0}={})=>Array.isArray(e)&&e.length>=n&&e.every(t),mt=e=>!Number.isNaN(+e)&&+e>=0,ht=e=>!Number.isNaN(+e)&&+e>0,ft=(e,t)=>n=>e.indexOf(n)>=0?n:t,yt=(e,t,n=15e3)=>new Promise(((o,r)=>{((e,t=!1,n=15e3)=>new Promise(((o,r)=>{const i=new Image;t&&(i.crossOrigin="anonymous"),i.src=e,i.onload=()=>{o(i)};const a=()=>{r(new Error("IMAGE_LOAD_ERROR"))};i.onerror=a,setTimeout(a,n)})))(t,0!==t.indexOf(window.location.origin)&&-1===t.indexOf("base64"),n).then((t=>{o(e.texture(t))})).catch((e=>{r(e)}))})),gt=e=>e>=0&&e<=1,vt=e=>Array.isArray(e)&&e.every(gt),wt=e=>"string"==typeof e||e instanceof String,xt=e=>Number.isInteger(e)&&e>=0&&e<=255,bt=e=>Array.isArray(e)&&e.every(xt),St=e=>Array.isArray(e)&&e.length&&(Array.isArray(e[0])||wt(e[0])),Et=(e,t)=>e>t?e:t,Ct=(e,t)=>e<t?e:t,Pt=(e,t)=>{if(4===(n=e).length&&(vt(n)||bt(n))){const n=vt(e);return t&&n||!t&&!n?e:t&&!n?e.map((e=>e/255)):e.map((e=>255*e))}var n,o;if(3===(o=e).length&&(vt(o)||bt(o))){const n=255**!t,o=vt(e);return t&&o||!t&&!o?[...e,n]:t&&!o?[...e.map((e=>e/255)),n]:[...e.map((e=>255*e)),n]}return/(^#[0-9A-F]{6}$)|(^#[0-9A-F]{3}$)/i.test(e)?((e,t=!1)=>[...ut(e,t),255**!t])(e,t):(console.warn("Only HEX, RGB, and RGBA are handled by this function. Returning white instead."),t?[1,1,1,1]:[255,255,255,255])},Mt=e=>Object.entries(e).reduce(((e,[t,n])=>(e[n]?e[n]=[...e[n],t]:e[n]=t,e)),{}),At=e=>.21*e[0]+.72*e[1]+.07*e[2],It=(e={})=>{let{regl:t,canvas:n=document.createElement("canvas"),gamma:o=Ee}=e;t||(t=ct(n));const r=lt(t),i=[n.width,n.height],a=t.framebuffer({width:i[0],height:i[1],colorFormat:"rgba",colorType:"float"}),s=t({vert:"\n      precision highp float;\n      attribute vec2 xy;\n      void main () {\n        gl_Position = vec4(xy, 0, 1);\n      }",frag:"\n      precision highp float;\n      uniform vec2 srcRes;\n      uniform sampler2D src;\n      uniform float gamma;\n\n      vec3 approxLinearToSRGB (vec3 rgb, float gamma) {\n        return pow(clamp(rgb, vec3(0), vec3(1)), vec3(1.0 / gamma));\n      }\n\n      void main () {\n        vec4 color = texture2D(src, gl_FragCoord.xy / srcRes);\n        gl_FragColor = vec4(approxLinearToSRGB(color.rgb, gamma), color.a);\n      }",attributes:{xy:[-4,-4,4,-4,0,4]},uniforms:{src:()=>a,srcRes:()=>i,gamma:()=>o},count:3,depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"one",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}}}),l=new Set,c=t.frame((()=>{const e=l.values();let t=e.next();for(;!t.done;)t.value(),t=e.next()})),d=()=>{n.width=window.innerWidth*window.devicePixelRatio,n.height=window.innerHeight*window.devicePixelRatio,i[0]=n.width,i[1]=n.height,a.resize(...i)};e.canvas||(window.addEventListener("resize",d),window.addEventListener("orientationchange",d),d());return{get canvas(){return n},get regl(){return t},get gamma(){return o},set gamma(e){o=+e},get isSupported(){return r},render:(e,o)=>{t.clear(N),a.use((()=>{t.clear(N),e()})),s(),(e=>{const t=e.getContext("2d");t.clearRect(0,0,e.width,e.height),t.drawImage(n,(n.width-e.width)/2,(n.height-e.height)/2,e.width,e.height,0,0,e.width,e.height)})(o)},onFrame:e=>(l.add(e),()=>{l.delete(e)}),refresh:()=>{t.poll()},destroy:()=>{c.cancel(),n=void 0,t=void 0,window.removeEventListener("resize",d),window.removeEventListener("orientationchange",d)}}},Rt=(e,t)=>`${e}ms ease-out effectIn ${t}ms 1 normal forwards`,Tt=(e,t)=>`${e}ms linear leftSpinIn ${t}ms 1 normal forwards`,Ot=(e,t)=>`${e}ms linear rightSpinIn ${t}ms 1 normal forwards`,Lt=(e,t)=>`${e}ms linear circleIn ${t}ms 1 normal forwards`,Bt=(e,t,n)=>`\n  @keyframes mainIn {\n    0% {\n      color: ${t};\n      opacity: 0;\n    }\n    0%, ${e}% {\n      color: ${t};\n      opacity: 1;\n    }\n    100% {\n      color: ${n};\n      opacity: 0.8;\n    }\n  }\n`,$t=(e,t,n,o)=>`\n  @keyframes effectIn {\n    0%, ${e}% {\n      opacity: ${n};\n      transform: scale(${o});\n    }\n    ${t}% {\n      opacity: 0.66;\n      transform: scale(1.5);\n    }\n    99% {\n      opacity: 0;\n      transform: scale(2);\n    }\n    100% {\n      opacity: 0;\n      transform: scale(0);\n    }\n  }\n`,zt=(e,t)=>`\n  @keyframes leftSpinIn {\n    0% {\n      transform: rotate(${t}deg);\n    }\n    ${e}%, 100% {\n      transform: rotate(360deg);\n    }\n  }\n`,Dt=(e,t)=>`\n  @keyframes rightSpinIn {\n    0% {\n      transform: rotate(${t}deg);\n    }\n    ${e}%, 100% {\n      transform: rotate(180deg);\n    }\n  }\n`,kt=e=>`${e}ms linear effectOut 0s 1 normal forwards`,Ft=e=>`${e}ms linear leftSpinOut 0s 1 normal forwards`,Nt=e=>`${e}ms linear rightSpinOut 0s 1 normal forwards`,jt=e=>`${e}ms linear circleOut 0s 1 normal forwards`,_t=(e,t)=>`\n  @keyframes mainOut {\n    0% {\n      color: ${e};\n    }\n    100% {\n      color: ${t};\n    }\n  }\n`,Vt=(e,t)=>`\n  @keyframes rightSpinOut {\n    0%, ${e}% {\n      transform: rotate(${t}deg);\n    }\n    100% {\n      transform: rotate(0deg);\n    }\n`,Wt=e=>`\n  @keyframes leftSpinOut {\n    0% {\n      transform: rotate(${e}deg);\n    }\n    100% {\n      transform: rotate(0deg);\n    }\n  }\n`,Zt=(e,t,n)=>`\n  @keyframes circleOut {\n    0%, ${e}% {\n      clip-path: ${t};\n      opacity: ${n};\n    }\n    ${e+.01}% {\n      clip-path: inset(0 0 0 50%);\n      opacity: ${n};\n    }\n    100% {\n      clip-path: inset(0 0 0 50%);\n      opacity: 0;\n    }\n  }\n`,qt=(e,t=null)=>null===e?t:e;let Gt;const Ht=()=>{if(!Gt){const e=document.createElement("style");document.head.appendChild(e),Gt=e.sheet}return Gt},Kt=e=>{const t=Ht(),n=t.rules.length;return t.insertRule(e,n),n},Xt=e=>{Ht().deleteRule(e)};let Yt=null;let Ut=null;const Jt=(e,{onDraw:t=T,onStart:n=T,onEnd:o=T,enableInitiator:r=true,initiatorParentElement:i=document.body,longPressIndicatorParentElement:a=document.body,minDelay:s=8,minDist:l=2,pointNorm:c=T}={})=>{let d=r,u=i,p=a,m=t,h=n,f=o,y=c;const g=document.createElement("div"),v=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);g.id=`lasso-initiator-${v}`,g.style.position="fixed",g.style.display="flex",g.style.justifyContent="center",g.style.alignItems="center",g.style.zIndex=99,g.style.width="4rem",g.style.height="4rem",g.style.borderRadius="4rem",g.style.opacity=.5,g.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)";const{longPress:w,longPressCircle:x,longPressCircleLeft:b,longPressCircleRight:S,longPressEffect:E}=(()=>{const e=document.createElement("div"),t=Math.random().toString(36).substring(2,5)+Math.random().toString(36).substring(2,5);e.id=`lasso-long-press-${t}`,e.style.position="fixed",e.style.width="1.25rem",e.style.height="1.25rem",e.style.pointerEvents="none",e.style.transform="translate(-50%,-50%)";const n=document.createElement("div");n.style.position="absolute",n.style.top=0,n.style.left=0,n.style.width="1.25rem",n.style.height="1.25rem",n.style.clipPath="inset(0px 0px 0px 50%)",n.style.opacity=0,e.appendChild(n);const o=document.createElement("div");o.style.position="absolute",o.style.top=0,o.style.left=0,o.style.width="0.8rem",o.style.height="0.8rem",o.style.border="0.2rem solid currentcolor",o.style.borderRadius="0.8rem",o.style.clipPath="inset(0px 50% 0px 0px)",o.style.transform="rotate(0deg)",n.appendChild(o);const r=document.createElement("div");r.style.position="absolute",r.style.top=0,r.style.left=0,r.style.width="0.8rem",r.style.height="0.8rem",r.style.border="0.2rem solid currentcolor",r.style.borderRadius="0.8rem",r.style.clipPath="inset(0px 50% 0px 0px)",r.style.transform="rotate(0deg)",n.appendChild(r);const i=document.createElement("div");return i.style.position="absolute",i.style.top=0,i.style.left=0,i.style.width="1.25rem",i.style.height="1.25rem",i.style.borderRadius="1.25rem",i.style.background="currentcolor",i.style.transform="scale(0)",i.style.opacity=0,e.appendChild(i),{longPress:e,longPressCircle:n,longPressCircleLeft:o,longPressCircleRight:r,longPressEffect:i}})();let C,P=!1,M=!1,A=[],I=[],R=!1,O=null,D=null,k=null,F=null,N=null,j=null,_=null,V=null,W=null,Z=null;const q=()=>{P=!1};window.addEventListener("mouseup",q);const G=()=>{g.style.opacity=.5,g.style.transform="translate(-50%,-50%) scale(0) rotate(0deg)"},H=(e,t)=>{const n=getComputedStyle(e),o=+n.opacity,r=n.transform.match(/([0-9.-]+)+/g),i=+r[0],a=+r[1],s=Math.sqrt(i*i+a*a);let l=Math.atan2(a,i)*(180/Math.PI);return l=t&&l<=0?360+l:l,{opacity:o,scale:s,rotate:l}},K=e=>{if(!d||P)return;const t=e.clientX,n=e.clientY;g.style.top=`${n}px`,g.style.left=`${t}px`;const o=H(g),r=o.opacity,i=o.scale,a=o.rotate;g.style.opacity=r,g.style.transform=`translate(-50%,-50%) scale(${i}) rotate(${a}deg)`,g.style.animation="none",$().then((()=>{null!==Yt&&Xt(Yt),Yt=Kt(((e,t,n)=>`\n@keyframes scaleInFadeOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  10% {\n    opacity: 1;\n    transform: translate(-50%,-50%) scale(1) rotate(${n+20}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0.9) rotate(${n+60}deg);\n  }\n}\n`)(r,i,a)),g.style.animation="2500ms ease scaleInFadeOut 0s 1 normal backwards",$().then((()=>{G()}))}))},X=()=>{const{opacity:e,scale:t,rotate:n}=H(g);g.style.opacity=e,g.style.transform=`translate(-50%,-50%) scale(${t}) rotate(${n}deg)`,g.style.animation="none",$(2).then((()=>{null!==Ut&&Xt(Ut),Ut=Kt(((e,t,n)=>`\n@keyframes fadeScaleOut {\n  0% {\n    opacity: ${e};\n    transform: translate(-50%,-50%) scale(${t}) rotate(${n}deg);\n  }\n  100% {\n    opacity: 0;\n    transform: translate(-50%,-50%) scale(0) rotate(${n}deg);\n  }\n}\n`)(e,t,n)),g.style.animation="250ms ease fadeScaleOut 0s 1 normal backwards",$().then((()=>{G()}))}))},Y=(e,t,{time:n=ae,extraTime:o=se,delay:r=le}={time:ae,extraTime:se,delay:le})=>{R=!0;const i=getComputedStyle(w);w.style.color=i.color,w.style.top=`${t}px`,w.style.left=`${e}px`,w.style.animation="none";const a=getComputedStyle(x);x.style.clipPath=a.clipPath,x.style.opacity=a.opacity,x.style.animation="none";const s=H(E);E.style.opacity=s.opacity,E.style.transform=`scale(${s.scale})`,E.style.animation="none";const l=H(b);b.style.transform=`rotate(${l.rotate}deg)`,b.style.animation="none";const c=H(S);S.style.transform=`rotate(${c.rotate}deg)`,S.style.animation="none",$().then((()=>{if(!R)return;null!==N&&Xt(N),null!==F&&Xt(F),null!==k&&Xt(k),null!==D&&Xt(D),null!==O&&Xt(O);const{rules:e,names:t}=(({time:e=ae,extraTime:t=se,delay:n=le,currentColor:o,targetColor:r,effectOpacity:i,effectScale:a,circleLeftRotation:s,circleRightRotation:l,circleClipPath:c,circleOpacity:d})=>{const u=s/360,p=((e,t,n)=>(1-e)*t+n)(u,e,t),m=Math.round((1-u)*e/p*100),h=Math.round(m/2),f=m+(100-m)/4;return{rules:{main:Bt(m,o,r),effect:$t(m,f,i,a),circleRight:Dt(h,l),circleLeft:zt(m,s),circle:(v=h,w=c,x=d,`\n  @keyframes circleIn {\n    0% {\n      clip-path: ${w};\n      opacity: ${x};\n    }\n    ${v}% {\n      clip-path: ${w};\n      opacity: 1;\n    }\n    ${v+.01}%, 100% {\n      clip-path: inset(0);\n      opacity: 1;\n    }\n  }\n`)},names:{main:(y=p,g=n,`${y}ms ease-out mainIn ${g}ms 1 normal forwards`),effect:Rt(p,n),circleLeft:Tt(p,n),circleRight:Ot(p,n),circle:Lt(p,n)}};var y,g,v,w,x})({time:n,extraTime:o,delay:r,currentColor:i.color||"currentcolor",targetColor:w.dataset.activeColor,effectOpacity:s.opacity||0,effectScale:s.scale||0,circleLeftRotation:l.rotate||0,circleRightRotation:c.rotate||0,circleClipPath:a.clipPath||"inset(0 0 0 50%)",circleOpacity:a.opacity||0});O=Kt(e.main),D=Kt(e.effect),k=Kt(e.circleLeft),F=Kt(e.circleRight),N=Kt(e.circle),w.style.animation=t.main,E.style.animation=t.effect,b.style.animation=t.circleLeft,S.style.animation=t.circleRight,x.style.animation=t.circle}))},U=({time:e=ce}={time:ce})=>{if(!R)return;R=!1;const t=getComputedStyle(w);w.style.color=t.color,w.style.animation="none";const n=getComputedStyle(x);x.style.clipPath=n.clipPath,x.style.opacity=n.opacity,x.style.animation="none";const o=H(E);E.style.opacity=o.opacity,E.style.transform=`scale(${o.scale})`,E.style.animation="none";const r="x"===n.clipPath.slice(-2,-1),i=H(b,r);b.style.transform=`rotate(${i.rotate}deg)`,b.style.animation="none";const a=H(S);S.style.transform=`rotate(${a.rotate}deg)`,S.style.animation="none",$().then((()=>{null!==Z&&Xt(Z),null!==W&&Xt(W),null!==V&&Xt(V),null!==_&&Xt(_),null!==j&&Xt(j);const{rules:r,names:s}=(({time:e=ce,currentColor:t,targetColor:n,effectOpacity:o,effectScale:r,circleLeftRotation:i,circleRightRotation:a,circleClipPath:s,circleOpacity:l})=>{const c=i/360,d=c*e,u=Math.min(100,100*c),p=u>50?Math.round(100*(1-50/u)):0;return{rules:{main:_t(t,n),effect:(h=o,f=r,`\n  @keyframes effectOut {\n    0% {\n      opacity: ${h};\n      transform: scale(${f});\n    }\n    99% {\n      opacity: 0;\n      transform: scale(${f+.5});\n    }\n    100% {\n      opacity: 0;\n      transform: scale(0);\n    }\n  }\n`),circleRight:Vt(p,a),circleLeft:Wt(i),circle:Zt(p,s,l)},names:{main:(m=d,`${m}ms linear mainOut 0s 1 normal forwards`),effect:kt(d),circleRight:Ft(d),circleLeft:Nt(d),circle:jt(d)}};var m,h,f})({time:e,currentColor:t.color||"currentcolor",targetColor:w.dataset.color,effectOpacity:o.opacity||0,effectScale:o.scale||0,circleLeftRotation:i.rotate||0,circleRightRotation:a.rotate||0,circleClipPath:n.clipPath||"inset(0px)",circleOpacity:n.opacity||1});j=Kt(r.main),_=Kt(r.effect),V=Kt(r.circleLeft),W=Kt(r.circleRight),Z=Kt(r.circle),w.style.animation=s.main,E.style.animation=s.effect,b.style.animation=s.circleLeft,S.style.animation=s.circleRight,x.style.animation=s.circle}))},J=()=>{m(A,I)},Q=e=>{if(C){if((t=e[0],n=e[1],o=C[0],r=C[1],Math.sqrt((t-o)**2+(n-r)**2))>2){C=e;const t=y(e);A.push(t),I.push(t[0],t[1]),A.length>1&&J()}}else{M||(M=!0,h()),C=e;const t=y(e);A=[t],I=[t[0],t[1]]}var t,n,o,r},ee=z(Q,8,8),te=(t,n)=>{const o=(t=>{const{left:n,top:o}=e.getBoundingClientRect();return[t.clientX-n,t.clientY-o]})(t);return n?ee(o):Q(o)},ne=()=>{A=[],I=[],C=void 0,J()},oe=e=>{K(e)},re=()=>{P=!0,M=!0,ne(),h()},ie=()=>{X()},de=({merge:e=!1}={})=>{M=!1;const t=[...A],n=[...I];return ee.cancel(),ne(),t.length&&f(t,n,{merge:e}),t},ue=({onDraw:e=null,onStart:t=null,onEnd:n=null,enableInitiator:o=null,initiatorParentElement:r=null,longPressIndicatorParentElement:i=null,minDelay:a=null,minDist:s=null,pointNorm:l=null}={})=>{m=qt(e,m),h=qt(t,h),f=qt(n,f),d=qt(o,d),y=qt(l,y),null!==r&&r!==u&&(u.removeChild(g),r.appendChild(g),u=r),null!==i&&i!==p&&(p.removeChild(w),i.appendChild(w),p=i),d?(g.addEventListener("click",oe),g.addEventListener("mousedown",re),g.addEventListener("mouseleave",ie)):(g.removeEventListener("mousedown",re),g.removeEventListener("mouseleave",ie))},pe=()=>{u.removeChild(g),p.removeChild(w),window.removeEventListener("mouseup",q),g.removeEventListener("click",oe),g.removeEventListener("mousedown",re),g.removeEventListener("mouseleave",ie)};return u.appendChild(g),p.appendChild(w),ue({onDraw:m,onStart:h,onEnd:f,enableInitiator:d,initiatorParentElement:u}),((...e)=>t=>e.reduce(((e,t)=>t(e)),t))(B("initiator",g),B("longPressIndicator",w),(e=>L(e,{clear:ne,destroy:pe,end:de,extend:te,set:ue,showInitiator:K,hideInitiator:X,showLongPressIndicator:Y,hideLongPressIndicator:U})),(me=Jt,e=>L({__proto__:{constructor:me}},e)))({});var me},Qt=e=>`\nprecision highp float;\n\nuniform sampler2D colorTex;\nuniform float colorTexRes;\nuniform float colorTexEps;\nuniform sampler2D stateTex;\nuniform float stateTexRes;\nuniform float stateTexEps;\nuniform float devicePixelRatio;\nuniform sampler2D encodingTex;\nuniform float encodingTexRes;\nuniform float encodingTexEps;\nuniform float pointSizeExtra;\nuniform float pointOpacityMax;\nuniform float pointOpacityScale;\nuniform float numPoints;\nuniform float globalState;\nuniform float isColoredByZ;\nuniform float isColoredByW;\nuniform float isOpacityByZ;\nuniform float isOpacityByW;\nuniform float isOpacityByDensity;\nuniform float isSizedByZ;\nuniform float isSizedByW;\nuniform float colorMultiplicator;\nuniform float opacityMultiplicator;\nuniform float opacityDensity;\nuniform float sizeMultiplicator;\nuniform float numColorStates;\nuniform float pointScale;\nuniform mat4 modelViewProjection;\n\nattribute vec2 stateIndex;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nvoid main() {\n  vec4 state = texture2D(stateTex, stateIndex);\n\n  gl_Position = modelViewProjection * vec4(state.x, state.y, 0.0, 1.0);\n\n  // Determine color index\n  float colorIndexZ =  isColoredByZ * floor(state.z * colorMultiplicator);\n  float colorIndexW =  isColoredByW * floor(state.w * colorMultiplicator);\n\n  // Multiply by the number of color states per color\n  // I.e., normal, active, hover, background, etc.\n  float colorIndex = (colorIndexZ + colorIndexW) * numColorStates;\n\n  // Half a "pixel" or "texel" in texture coordinates\n  float colorLinearIndex = colorIndex + globalState;\n\n  // Need to add cEps here to avoid floating point issue that can lead to\n  // dramatic changes in which color is loaded as floor(3/2.9999) = 1 but\n  // floor(3/3.0001) = 0!\n  float colorRowIndex = floor((colorLinearIndex + colorTexEps) / colorTexRes);\n\n  vec2 colorTexIndex = vec2(\n    (colorLinearIndex / colorTexRes) - colorRowIndex + colorTexEps,\n    colorRowIndex / colorTexRes + colorTexEps\n  );\n\n  color = texture2D(colorTex, colorTexIndex);\n\n  // Retrieve point size\n  float pointSizeIndexZ = isSizedByZ * floor(state.z * sizeMultiplicator);\n  float pointSizeIndexW = isSizedByW * floor(state.w * sizeMultiplicator);\n  float pointSizeIndex = pointSizeIndexZ + pointSizeIndexW;\n\n  float pointSizeRowIndex = floor((pointSizeIndex + encodingTexEps) / encodingTexRes);\n  vec2 pointSizeTexIndex = vec2(\n    (pointSizeIndex / encodingTexRes) - pointSizeRowIndex + encodingTexEps,\n    pointSizeRowIndex / encodingTexRes + encodingTexEps\n  );\n  float pointSize = texture2D(encodingTex, pointSizeTexIndex).x;\n\n  // Retrieve opacity\n  ${3===e?"":`\n        if (isOpacityByDensity < 0.5) {\n          float opacityIndexZ = isOpacityByZ * floor(state.z * opacityMultiplicator);\n          float opacityIndexW = isOpacityByW * floor(state.w * opacityMultiplicator);\n          float opacityIndex = opacityIndexZ + opacityIndexW;\n\n          float opacityRowIndex = floor((opacityIndex + encodingTexEps) / encodingTexRes);\n          vec2 opacityTexIndex = vec2(\n            (opacityIndex / encodingTexRes) - opacityRowIndex + encodingTexEps,\n            opacityRowIndex / encodingTexRes + encodingTexEps\n          );\n          color.a = texture2D(encodingTex, opacityTexIndex)[${1+e}];\n        } else {\n          color.a = min(1.0, opacityDensity + globalState);\n        }\n      `}\n\n  color.a = min(pointOpacityMax, color.a) * pointOpacityScale;\n  finalPointSize = (pointSize * pointScale) + pointSizeExtra;\n  gl_PointSize = finalPointSize;\n}\n`,en=function(){const e=(e,t,n,o,r)=>{const i=.5*(o-t),a=.5*(r-n);return(2*n-2*o+i+a)*e*e*e+(-3*n+3*o-2*i-a)*e*e+i*e+n},t=(t,n,o)=>{const r=o*t,i=Math.floor(r),a=r-i,s=n[Math.max(0,i-1)],l=n[i],c=n[Math.min(o,i+1)],d=n[Math.min(o,i+2)];return[e(a,s[0],l[0],c[0],d[0]),e(a,s[1],l[1],c[1],d[1])]},n=(e,t,n)=>{let o=t[0],r=t[1],i=n[0]-o,a=n[1]-r;if(0!==i||0!==a){const t=((e[0]-o)*i+(e[1]-r)*a)/(i*i+a*a);t>1?(o=n[0],r=n[1]):t>0&&(o+=i*t,r+=a*t)}return i=e[0]-o,a=e[1]-r,i*i+a*a},o=(e,t,r,i,a)=>{let s,l=i;for(let o=t+1;o<r;o++){const i=n(e[o],e[t],e[r]);i>l&&(s=o,l=i)}l>i&&(s-t>1&&o(e,t,s,i,a),a.push(e[s]),r-s>1&&o(e,s,r,i,a))},r=(e,t)=>{const n=e.length-1,r=[e[0]];return o(e,0,n,t,r),r.push(e[n]),r};self.onmessage=function(e){(e.data.points?+e.data.points.length:0)||self.postMessage({error:new Error("No points provided")}),e.data.points;const n=(e=>{const t={},n=!Number.isNaN(+e[0][5]);return e.forEach((e=>{const o=e[4];t[o]||(t[o]=[]),n?t[o][e[5]]=e:t[o].push(e)})),Object.entries(t).forEach((e=>{t[e[0]]=e[1].filter((e=>e)),t[e[0]].reference=e[1][0]})),t})(e.data.points);self.postMessage({points:Object.entries(n).reduce(((n,o)=>(n[o[0]]=((e,{maxIntPointsPerSegment:n=100,tolerance:o=.002}={})=>{const i=e.length,a=i-1,s=a*n+1,l=o**2;let c,d=[];for(let o=0;o<i-1;o++){let i=[e[o].slice(0,2)];c=e[o];for(let r=1;r<n;r++){const d=t((o*n+r)/s,e,a);u=c[0],p=c[1],(u-d[0])**2+(p-d[1])**2>l&&(i.push(d),c=d)}i.push(e[o+1]),i=r(i,l),d=d.concat(i.slice(0,i.length-1))}var u,p;
/**
   * Douglas Peucker square segment distance
   * Implementation from https://github.com/mourner/simplify-js
   * @author Vladimir Agafonkin
   * @copyright Vladimir Agafonkin 2013
   * @license BSD
   * @param {array} p - Point
   * @param {array} p1 - First boundary point
   * @param {array} p2 - Second boundary point
   * @return {number} Distance
   */return d.push(e[e.length-1].slice(0,2)),d.flat()})(o[1],e.data.options),n[o[0]].reference=o[1].reference,n)),{})})}},tn=(e,t={tolerance:.002,maxIntPointsPerSegment:100})=>new Promise(((n,o)=>{const r=(i=en,new Worker(window.URL.createObjectURL(new Blob([`(${i.toString()})()`],{type:"text/javascript"}))));var i;r.onmessage=e=>{e.data.error?o(e.data.error):n(e.data.points),r.terminate()},r.postMessage({points:e,options:t})}));const nn={showRecticle:"showReticle",recticleColor:"reticleColor"},on=e=>{Object.keys(e).filter((e=>nn[e])).forEach((t=>{console.warn(`regl-scatterplot: the "${t}" property is deprecated. Please use "${nn[t]}" instead.`),e[nn[t]]=e[t],delete e[t]}))},rn=(e,t,{allowSegment:n=!1,allowDensity:o=!1}={})=>at.has(e)?"valueZ":st.has(e)?"valueW":"segment"===e?n?"segment":t:"density"===e&&o?"density":t,an=e=>{switch(e){case"valueZ":return 2;case"valueW":return 3;default:return null}},sn=(t={})=>{const n=e({async:!t.syncEvents,caseInsensitive:!0}),o=new Float32Array(16),r=new Float32Array(16),l=[0,0];on(t);let{renderer:u,backgroundColor:p=We,backgroundImage:m=Ye,canvas:f=document.createElement("canvas"),colorBy:y=Ne,deselectOnDblClick:g=Qe,deselectOnEscape:v=et,lassoColor:w=Q,lassoLineWidth:x=ee,lassoMinDelay:b=ne,lassoMinDist:E=oe,lassoClearEvent:C=re,lassoInitiator:P=te,lassoInitiatorParentElement:M=document.body,lassoOnLongPress:A=ie,lassoLongPressTime:R=ae,lassoLongPressAfterEffectTime:L=se,lassoLongPressEffectDelay:B=le,lassoLongPressRevertEffectTime:$=ce,keyMap:F=xe,mouseMode:N=Z,showReticle:Ee=Ue,reticleColor:lt=Je,pointColor:ct=je,pointColorActive:ut=_e,pointColorHover:gt=Ve,showPointConnections:vt=tt,pointConnectionColor:xt=qe,pointConnectionColorActive:bt=Ge,pointConnectionColorHover:Rt=He,pointConnectionColorBy:Tt=Ze,pointConnectionOpacity:Ot=Oe,pointConnectionOpacityBy:Lt=Le,pointConnectionOpacityActive:Bt=Be,pointConnectionSize:$t=Ie,pointConnectionSizeActive:zt=Re,pointConnectionSizeBy:Dt=Te,pointConnectionMaxIntPointsPerSegment:kt=nt,pointConnectionTolerance:Ft=ot,pointSize:Nt=Ce,pointSizeSelected:jt=Pe,pointSizeMouseDetection:_t=rt,pointOutlineWidth:Vt=Me,opacity:Wt=D,opacityBy:Zt=$e,opacityByDensityFill:qt=ze,opacityInactiveMax:Gt=ke,opacityInactiveScale:Ht=Fe,sizeBy:Kt=Ae,height:Xt=Se,width:Yt=be}=t,Ut=Yt===D?1:Yt,en=Xt===D?1:Xt;const{performanceMode:nn=it,opacityByDensityDebounceTime:sn=De}=t;u||(u=It({regl:t.regl,gamma:t.gamma})),p=Pt(p,!0),w=Pt(w,!0),lt=Pt(lt,!0);let ln,cn,dn=!1,un=At(p),pn=!1,mn=null,hn=[0,0],fn=-1,yn=[];const gn=new Set,vn=new Set;let wn=!1;const xn=new Set;let bn,Sn,En,Cn,Pn,Mn,An,In,Rn,Tn,On,Ln,Bn,$n,zn,Dn=0,kn=0,Fn=!1,Nn=[],jn=1,_n=Mt(F),Vn=!1,Wn=!0,Zn=!1;ct=St(ct)?[...ct]:[ct],ut=St(ut)?[...ut]:[ut],gt=St(gt)?[...gt]:[gt],ct=ct.map((e=>Pt(e,!0))),ut=ut.map((e=>Pt(e,!0))),gt=gt.map((e=>Pt(e,!0))),Wt=!Array.isArray(Wt)&&Number.isNaN(+Wt)?ct[0][3]:Wt,Wt=pt(Wt,mt,{minLength:1})?[...Wt]:[Wt],Nt=pt(Nt,mt,{minLength:1})?[...Nt]:[Nt];let qn,Gn,Hn,Kn,Xn=1/Nt[0];"inherit"===xt?xt=[...ct]:(xt=St(xt)?[...xt]:[xt],xt=xt.map((e=>Pt(e,!0)))),"inherit"===bt?bt=[...ut]:(bt=St(bt)?[...bt]:[bt],bt=bt.map((e=>Pt(e,!0)))),"inherit"===Rt?Rt=[...gt]:(Rt=St(Rt)?[...Rt]:[Rt],Rt=Rt.map((e=>Pt(e,!0)))),Ot="inherit"===Ot?[...Wt]:pt(Ot,mt,{minLength:1})?[...Ot]:[Ot],$t="inherit"===$t?[...Nt]:pt($t,mt,{minLength:1})?[...$t]:[$t],y=rn(y,Ne),Zt=rn(Zt,$e,{allowDensity:!0}),Kt=rn(Kt,Ae),Tt=rn(Tt,Ze,{allowSegment:!0}),Lt=rn(Lt,Le,{allowSegment:!0}),Dt=rn(Dt,Te,{allowSegment:!0});let Yn,Un,Jn,Qn,eo,to,no,oo,ro,io,ao,so,lo=0,co=0,uo=!1,po=null,mo=Ee,ho=0,fo=0,yo=!1,go=!1,vo=!1,wo=K,xo=K,bo=!1,So=t.xScale||null,Eo=t.yScale||null,Co=0,Po=0,Mo=0,Ao=0;So&&(Co=So.domain()[0],Po=So.domain()[1]-So.domain()[0],So.range([0,Ut])),Eo&&(Mo=Eo.domain()[0],Ao=Eo.domain()[1]-Eo.domain()[0],Eo.range([en,0]));const Io=e=>e/Ut*2-1,Ro=e=>1+e/en*-2,To=(e,t)=>{const n=[e,t,1,1];return d(n,n,a(o,s(o,En,s(o,ln.view,Pn)))),n.slice(0,2)},Oo=()=>{const e=Tr(),t=Bn[1]-$n[1];return On*e*(t/en)*.66},Lo=()=>wn?bn.points.filter(((e,t)=>xn.has(t))):bn.points,Bo=(e,t,n,o)=>{const r=bn.range(e,t,n,o);return wn?r.filter((e=>xn.has(e))):r},$o=()=>{const[e,t]=[Io(l[0]),Ro(l[1])],[n,o]=To(e,t),r=Oo(),i=Bo(n-r,o-r,n+r,o+r);let a,s=r;return i.forEach((e=>{const[t,r]=bn.points[e],i=dt(t,r,n,o);i<s&&(s=i,a=e)})),s<On/Ut*2?a:-1},zo=e=>{const t=(e=>{let t=1/0,n=-1/0,o=1/0,r=-1/0;for(let i=0;i<e.length;i+=2)t=e[i]<t?e[i]:t,n=e[i]>n?e[i]:n,o=e[i+1]<o?e[i+1]:o,r=e[i+1]>r?e[i+1]:r;return[t,o,n,r]})(e);if(!(([e,t,n,o])=>Number.isFinite(e)&&Number.isFinite(t)&&Number.isFinite(n)&&Number.isFinite(o)&&n-e>0&&o-t>0)(t))return[];const n=Bo(...t),o=[];return n.forEach((t=>{((e,[t,n]=[])=>{let o,r,i,a,s=!1;for(let l=0,c=e.length-2;l<e.length;l+=2)o=e[l],r=e[l+1],i=e[c],a=e[c+1],r>n!=a>n&&t<(i-o)*(n-r)/(a-r)+o&&(s=!s),c=l;return s})(e,bn.points[t])&&o.push(t)})),o},Do=()=>{Nn=[],cn&&cn.clear()},ko=e=>e&&e.length>4,Fo=(e,t)=>{if(In||!vt||!ko(bn.points[e[0]]))return;const n=0===t,o=1===t?e=>vn.add(e):T,r=Object.keys(e.reduce(((e,t)=>{const n=bn.points[t];return e[Array.isArray(n[4])?n[4][0]:n[4]]=!0,e}),{})),i=Mn.getData().opacities;r.filter((e=>!vn.has(+e))).forEach((e=>{const t=An[e][0],r=An[e][2],a=4*t+2*An[e][3],s=a+2*r+4;void 0===i.__original__&&(i.__original__=i.slice());for(let e=a;e<s;e++)i[e]=n?i.__original__[e]:Bt;o(e)})),Mn.getBuffer().opacities.subdata(i,0)},No=e=>[e%lo/lo+co,Math.floor(e/lo)/lo+co],jo=e=>wn&&!xn.has(e),_o=({preventEvent:e=!1}={})=>{C===Y&&Do(),yn.length&&(e||n.publish("deselect"),vn.clear(),Fo(yn,0),yn=[],gn.clear(),Wn=!0)},Vo=(e,{merge:t=!1,preventEvent:o=!1}={})=>{const r=Array.isArray(e)?e:[e],i=[...yn];if(t){if(yn=((e,t)=>{const n=[];return e.forEach((e=>{n[e]=!0})),t.forEach((e=>{n[e]=!0})),n.reduce(((e,t,n)=>(t&&e.push(n),e)),[])})(yn,r),i.length===yn.length)return void(Wn=!0)}else{if(yn&&yn.length&&Fo(yn,0),i.length>0&&0===r.length)return void _o({preventEvent:o});yn=r}if(((e,t)=>{if(e===t)return!0;if(e.length!==t.length)return!1;const n=new Set(e),o=new Set(t);return n.size===o.size&&t.every((e=>n.has(e)))})(i,yn))return void(Wn=!0);const a=[];gn.clear(),vn.clear();for(let e=yn.length-1;e>=0;e--){const t=yn[e];t<0||t>=Dn||jo(t)?yn.splice(e,1):(gn.add(t),a.push.apply(a,No(t)))}Un({usage:"dynamic",type:"float",data:a}),Fo(yn,1),o||n.publish("select",{points:yn}),Wn=!0},Wo=(e,{showReticleOnce:t=!1,preventEvent:o=!1}={})=>{let r=!1;if(e>=0&&e<Dn){r=!0;const t=so,i=e!==so;+t>=0&&i&&!gn.has(t)&&Fo([t],0),so=e,Jn.subdata(No(e)),gn.has(e)||Fo([e],2),i&&!o&&n.publish("pointover",so)}else r=+so>=0,r&&(gn.has(so)||Fo([so],0),o||n.publish("pointout",so)),so=void 0;r&&(Wn=!0,Zn=t)},Zo=e=>{const t=f.getBoundingClientRect();return l[0]=e.clientX-t.left,l[1]=e.clientY-t.top,[...l]},qo=Jt(f,{onStart:()=>{ln.config({isFixed:!0}),pn=!0,Fn=!0,Do(),fn>=0&&(clearTimeout(fn),fn=-1),n.publish("lassoStart")},onDraw:(e,t)=>{Nn=e,cn.setPoints(t),n.publish("lassoExtend",{coordinates:e})},onEnd:(e,t,{merge:o=!1}={})=>{ln.config({isFixed:!1}),Nn=[...e];const r=zo(t);Vo(r,{merge:o}),n.publish("lassoEnd",{coordinates:Nn}),C===U&&Do()},enableInitiator:P,initiatorParentElement:M,pointNorm:([e,t])=>To(Io(e),Ro(t))}),Go=(e,t)=>{switch(_n[t]){case he:return e.altKey;case fe:return e.metaKey;case ye:return e.ctrlKey;case ge:return e.metaKey;case ve:return e.shiftKey;default:return!1}},Ho=e=>{go&&1===e.buttons&&(pn=!0,mn=performance.now(),hn=Zo(e),Fn=N===_||Go(e,de),!Fn&&A&&(qo.showLongPressIndicator(e.clientX,e.clientY,{time:R,extraTime:L,delay:B}),fn=setTimeout((()=>{fn=-1,Fn=!0}),R)))},Ko=e=>{go&&(pn=!1,fn>=0&&(clearTimeout(fn),fn=-1),Fn&&(e.preventDefault(),Fn=!1,qo.end({merge:Go(e,pe)})),A&&qo.hideLongPressIndicator({time:$}))},Xo=e=>{if(!go)return;e.preventDefault();const t=Zo(e);if(dt(...t,...hn)>=E)return;const n=performance.now()-mn;if(!P||n<500){const t=$o();t>=0?(yn.length&&C===Y&&Do(),Vo([t],{merge:Go(e,pe)})):Ln||(Ln=setTimeout((()=>{Ln=null,qo.showInitiator(e)}),200))}},Yo=e=>{qo.hideInitiator(),Ln&&(clearTimeout(Ln),Ln=null),g&&(e.preventDefault(),_o())},Uo=e=>{if(vo||(bo=(e=>document.elementsFromPoint(e.clientX,e.clientY).some((e=>e===f)))(e),vo=!0),!go||!bo&&!pn)return;const t=Zo(e),n=dt(...t,...hn)>=E;bo&&!Fn&&Wo($o()),Fn?(e.preventDefault(),qo.extend(e,!0)):pn&&A&&n&&qo.hideLongPressIndicator({time:$}),fn>=0&&n&&(clearTimeout(fn),fn=-1),pn&&(Wn=!0)},Jo=()=>{so=void 0,bo=!1,vo=!1,go&&(+so>=0&&!gn.has(so)&&Fo([so],0),Ko(),Wn=!0)},Qo=()=>{const e=Math.max(Nt.length,Wt.length);fo=Math.max(2,Math.ceil(Math.sqrt(e)));const t=new Float32Array(fo**2*4);for(let n=0;n<e;n++){t[4*n]=Nt[n]||0,t[4*n+1]=Math.min(1,Wt[n]||0);const e=Number((ut[n]||ut[0])[3]);t[4*n+2]=Math.min(1,Number.isNaN(e)?1:e);const o=Number((gt[n]||gt[0])[3]);t[4*n+3]=Math.min(1,Number.isNaN(o)?1:o)}return u.regl.texture({data:t,shape:[fo,fo,4],type:"float"})},er=(e=ct,t=ut,n=gt)=>{const o=e.length,r=t.length,i=n.length,a=[];if(o===r&&r===i)for(let r=0;r<o;r++)a.push(e[r],t[r],n[r],p);else for(let r=0;r<o;r++){const o=[e[r][0],e[r][1],e[r][2],1],i=y===Ne?t[0]:o,s=y===Ne?n[0]:o;a.push(e[r],i,s,p)}return a},tr=()=>{const e=er(),t=e.length;ho=Math.max(2,Math.ceil(Math.sqrt(t)));const n=new Float32Array(ho**2*4);return e.forEach(((e,t)=>{n[4*t]=e[0],n[4*t+1]=e[1],n[4*t+2]=e[2],n[4*t+3]=e[3]})),u.regl.texture({data:n,shape:[ho,ho,4],type:"float"})},nr=()=>{Sn=Ut/en,En=c([],[1/Sn,1,1]),Cn=c([],[1/Sn,1,1]),Pn=c([],[jn,1,1])},or=(e,t)=>n=>{if(!n||!n.length)return;const o=[...e()];let r=St(n)?n:[n];r=r.map((e=>Pt(e,!0))),io&&io.destroy();try{t(r),io=tr()}catch(e){console.error("Invalid colors. Switching back to default colors."),t(o),io=tr()}},rr=or((()=>ct),(e=>{ct=e})),ir=or((()=>ut),(e=>{ut=e})),ar=or((()=>gt),(e=>{gt=e})),sr=()=>{if(!So&&!Eo)return;const[e,t]=(()=>{const e=To(-1,-1),t=To(1,1),n=(e[0]+1)/2,o=(t[0]+1)/2,r=(e[1]+1)/2,i=(t[1]+1)/2;return[[Co+n*Po,Co+o*Po],[Mo+r*Ao,Mo+i*Ao]]})();So&&So.domain(e),Eo&&Eo.domain(t)},lr=e=>{en=Math.max(1,e),f.height=Math.floor(en*window.devicePixelRatio),Eo&&(Eo.range([en,0]),sr())},cr=()=>{On=_t,_t===D&&(On=Array.isArray(Nt)?Nt[Math.floor(Nt.length/2)]:Nt)},dr=e=>{Ut=Math.max(1,e),f.width=Math.floor(Ut*window.devicePixelRatio),So&&(So.range([0,Ut]),sr())},ur=e=>{switch(e){case"valueZ":return wo;case"valueW":return xo;default:return null}},pr=(e,t)=>e===H?e=>Math.round(e*(t.length-1)):T,mr=()=>[f.width,f.height],hr=()=>io,fr=()=>ho,yr=()=>.5/ho,gr=()=>window.devicePixelRatio,vr=()=>Un,wr=()=>ao,xr=()=>fo,br=()=>.5/fo,Sr=()=>0,Er=()=>Hn||qn,Cr=()=>lo,Pr=()=>.5/lo,Mr=()=>Cn,Ar=()=>ln.view,Ir=()=>Pn,Rr=()=>s(r,Cn,s(r,ln.view,Pn)),Tr=()=>ln.scaling[0]>1?Math.asinh(Et(1,ln.scaling[0]))/Math.asinh(1)*window.devicePixelRatio:Et(Xn,ln.scaling[0])*window.devicePixelRatio,Or=()=>yn.length,Lr=()=>Or()>0?Gt:1,Br=()=>Or()>0?Ht:1,$r=()=>+("valueZ"===y),zr=()=>+("valueW"===y),Dr=()=>+("valueZ"===Zt),kr=()=>+("valueW"===Zt),Fr=()=>+("density"===Zt),Nr=()=>+("valueZ"===Kt),jr=()=>+("valueW"===Kt),_r=()=>"valueZ"===y?wo===H?ct.length-1:1:xo===H?ct.length-1:1,Vr=()=>"valueZ"===Zt?wo===H?Wt.length-1:1:xo===H?Nt.length-1:1,Wr=()=>"valueZ"===Kt?wo===H?Nt.length-1:1:xo===H?Nt.length-1:1,Zr=e=>{if("density"!==Zt)return 1;const t=Tr(),n=Nt[0]*t,o=2/(2/ln.view[0])*(2/(2/ln.view[5])),r=e.viewportHeight,i=e.viewportWidth;let a=qt*i*r/(kn*n*n)*Ct(1,o);a*=nn?1:1/(.25*Math.PI);return a*=(n/(Et(1,n)+.5))**2,Ct(1,Et(0,a))},qr=u.regl({framebuffer:()=>Kn,vert:"precision highp float;\n\nattribute vec2 position;\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // map normalized device coords to texture coords\n  particleTextureIndex = 0.5 * (1.0 + position);\n\n  gl_Position = vec4(position, 0, 1);\n}",frag:"precision highp float;\n\nuniform sampler2D startStateTex;\nuniform sampler2D endStateTex;\nuniform float t;\n\nvarying vec2 particleTextureIndex;\n\nvoid main() {\n  // Interpolate x, y, and value\n  vec3 start = texture2D(startStateTex, particleTextureIndex).xyw;\n  vec3 end = texture2D(endStateTex, particleTextureIndex).xyw;\n  vec3 curr = start * (1.0 - t) + end * t;\n\n  // The category cannot be interpolated\n  float endCategory = texture2D(endStateTex, particleTextureIndex).z;\n\n  gl_FragColor = vec4(curr.xy, endCategory, curr.z);\n}",attributes:{position:[-4,0,4,4,4,-4]},uniforms:{startStateTex:()=>Gn,endStateTex:()=>qn,t:(e,t)=>t.t},count:3}),Gr=(e,t,n,o=0,r=Lr,i=Br)=>u.regl({frag:nn?"precision highp float;\n\nvarying vec4 color;\n\nvoid main() {\n  gl_FragColor = color;\n}\n":"\nprecision highp float;\n\nvarying vec4 color;\nvarying float finalPointSize;\n\nfloat linearstep(float edge0, float edge1, float x) {\n  return clamp((x - edge0) / (edge1 - edge0), 0.0, 1.0);\n}\n\nvoid main() {\n  vec2 c = gl_PointCoord * 2.0 - 1.0;\n  float sdf = length(c) * finalPointSize;\n  float alpha = linearstep(finalPointSize + 0.5, finalPointSize - 0.5, sdf);\n\n  gl_FragColor = vec4(color.rgb, alpha * color.a);\n}\n",vert:Qt(o),blend:{enable:!nn,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},depth:{enable:!1},attributes:{stateIndex:{buffer:n,size:2}},uniforms:{resolution:mr,modelViewProjection:Rr,devicePixelRatio:gr,pointScale:Tr,encodingTex:wr,encodingTexRes:xr,encodingTexEps:br,pointOpacityMax:r,pointOpacityScale:i,pointSizeExtra:e,globalState:o,colorTex:hr,colorTexRes:fr,colorTexEps:yr,stateTex:Er,stateTexRes:Cr,stateTexEps:Pr,isColoredByZ:$r,isColoredByW:zr,isOpacityByZ:Dr,isOpacityByW:kr,isOpacityByDensity:Fr,isSizedByZ:Nr,isSizedByW:jr,colorMultiplicator:_r,opacityMultiplicator:Vr,opacityDensity:Zr,sizeMultiplicator:Wr,numColorStates:4},count:t,primitive:"points"}),Hr=Gr(Sr,(()=>wn?xn.size:Dn),(()=>Yn)),Kr=Gr(Sr,(()=>1),(()=>Jn),2,(()=>1),(()=>1)),Xr=Gr((()=>(jt+2*Vt)*window.devicePixelRatio),Or,vr,1,(()=>1),(()=>1)),Yr=Gr((()=>(jt+Vt)*window.devicePixelRatio),Or,vr,3,(()=>1),(()=>1)),Ur=Gr((()=>jt*window.devicePixelRatio),Or,vr,1,(()=>1),(()=>1)),Jr=u.regl({frag:"\nprecision mediump float;\n\nuniform sampler2D texture;\n\nvarying vec2 uv;\n\nvoid main () {\n  gl_FragColor = texture2D(texture, uv);\n}\n",vert:"\nprecision mediump float;\n\nuniform mat4 modelViewProjection;\n\nattribute vec2 position;\n\nvarying vec2 uv;\n\nvoid main () {\n  uv = position;\n  gl_Position = modelViewProjection * vec4(-1.0 + 2.0 * uv.x, 1.0 - 2.0 * uv.y, 0, 1);\n}\n",attributes:{position:[0,1,0,0,1,0,0,1,1,1,1,0]},uniforms:{modelViewProjection:Rr,texture:()=>m},count:6}),Qr=u.regl({vert:"\n      precision mediump float;\n      uniform mat4 modelViewProjection;\n      attribute vec2 position;\n      void main () {\n        gl_Position = modelViewProjection * vec4(position, 0, 1);\n      }",frag:"\n      precision mediump float;\n      uniform vec4 color;\n      void main () {\n        gl_FragColor = vec4(color.rgb, 0.2);\n      }",depth:{enable:!1},blend:{enable:!0,func:{srcRGB:"src alpha",srcAlpha:"one",dstRGB:"one minus src alpha",dstAlpha:"one minus src alpha"}},attributes:{position:()=>Nn},uniforms:{modelViewProjection:Rr,color:()=>w},elements:()=>Array.from({length:Nn.length-2},((e,t)=>[0,t+1,t+2]))}),ei=e=>{const t=new Float32Array(2*e);let n=0;for(let o=0;o<e;++o){const e=No(o);t[n]=e[0],t[n+1]=e[1],n+=2}return t},ti=(e,t={})=>{const n=e.length;lo=Math.max(2,Math.ceil(Math.sqrt(n))),co=.5/lo;const o=new Float32Array(lo**2*4);let r=!0,i=!0,a=0,s=0,l=0;for(let t=0;t<n;++t)a=4*t,o[a]=e[t][0],o[a+1]=e[t][1],s=e[t][2]||0,l=e[t][3]||0,o[a+2]=s,o[a+3]=l,r&&=Number.isInteger(s),i&&=Number.isInteger(l);return wo=t.z&&X.includes(t.z)?t.z:r?K:H,xo=t.w&&X.includes(t.w)?t.w:i?K:H,u.regl.texture({data:o,shape:[lo,lo,4],type:"float"})},ni=(e,t={})=>{go=!1,Dn=e.length,kn=Dn,qn&&qn.destroy(),qn=ti(e,t),Yn({usage:"static",type:"float",data:ei(Dn)}),bn=new S(e,(e=>e[0]),(e=>e[1]),16),go=!0},oi=(e,t)=>{Qn=ln.target,eo=e,to=ln.distance[0],no=t},ri=e=>{const t="inherit"===Tt?y:Tt;if("segment"===t){const t=xt.length-1;return t<1?[]:e.reduce(((e,n,o)=>{let r=0;const i=[];for(let e=2;e<n.length;e+=2){const t=Math.sqrt((n[e-2]-n[e])**2+(n[e-1]-n[e+1])**2);i.push(t),r+=t}e[o]=[0];let a=0;for(let s=0;s<n.length/2-1;s++)a+=i[s],e[o].push(4*Math.floor(a/r*t));return e}),[])}if(t){const e=an(t),n=pr(ur(t),"inherit"===Tt?ct:xt);return An.reduce(((t,[o,r])=>(t[o]=4*n(r[e]),t)),[])}return Array(An.length).fill(0)},ii=()=>{const e="inherit"===Lt?Zt:Lt;if("segment"===e){const e=Ot.length-1;return e<1?[]:An.reduce(((t,[n,o,r])=>(t[n]=O(r,(t=>Ot[Math.floor(t/(r-1)*e)])),t)),[])}if(e){const t=an(e),n="inherit"===Lt?Wt:Ot,o=pr(ur(e),n);return An.reduce(((e,[r,i])=>(e[r]=n[o(i[t])],e)),[])}},ai=()=>{const e="inherit"===Dt?Kt:Dt;if("segment"===e){const e=$t.length-1;return e<1?[]:An.reduce(((t,[n,o,r])=>(t[n]=O(r,(t=>$t[Math.floor(t/(r-1)*e)])),t)),[])}if(e){const t=an(e),n="inherit"===Dt?Nt:$t,o=pr(ur(e),n);return An.reduce(((e,[r,i])=>(e[r]=n[o(i[t])],e)),[])}},si=e=>new Promise((t=>{Mn.setPoints([]),e&&e.length?(In=!0,tn(e,{maxIntPointsPerSegment:kt,tolerance:Ft}).then((e=>{(e=>{An=[];let t=0;Object.keys(e).forEach(((n,o)=>{An[n]=[o,e[n].reference,e[n].length/2,t],t+=e[n].length/2}))})(e);const n=Object.values(e);Mn.setPoints(1===n.length?n[0]:n,{colorIndices:ri(n),opacities:ii(),widths:ai()}),In=!1,t()}))):t()})),li=(e,{preventEvent:t=!1}={})=>{const o=Array.isArray(e)?e:[e];wn=!0,xn.clear();const r=[],i=[];for(let e=o.length-1;e>=0;e--){const t=o[e];t<0||t>=Dn?o.splice(e,1):(xn.add(t),r.push.apply(r,No(t)),gn.has(t)&&i.push(t))}return Yn.subdata(r),Vo(i,{preventEvent:t}),xn.has(so)||Wo(-1,{preventEvent:t}),new Promise((e=>{const r=()=>{n.subscribe("draw",(()=>{t||n.publish("filter",{points:o}),e()}),1),Wn=!0};vt||ko(bn.points[0])?si(Lo()).then((()=>{t||n.publish("pointConnectionsDraw"),Vo(i,{preventEvent:t}),r()})):r()}))},ci=()=>Bo($n[0],$n[1],Bn[0],Bn[1]),di=z((()=>{kn=ci().length}),sn),ui=()=>Boolean(Gn&&Hn),pi=()=>Boolean(void 0!==Qn&&void 0!==eo&&void 0!==to&&void 0!==no),mi=(e,t)=>{po||(po=performance.now());const n=performance.now()-po,o=(r=t(n/e),i=0,a=1,Math.min(a,Math.max(i,r)));var r,i,a;return ui()&&qr({t:o}),pi()&&(e=>{const[t,n]=Qn,[o,r]=eo,i=1-e,a=t*i+o*e,s=n*i+r*e,l=to*i+no*e;ln.lookAt([a,s],l)})(o),n<e},hi=()=>{uo=!1,po=null,oo=void 0,ro=void 0,Ee=mo,Gn&&(Gn.destroy(),Gn=void 0),Hn&&(Hn.destroy(),Hn=void 0),Qn=void 0,eo=void 0,to=void 0,no=void 0,n.publish("transitionEnd")},fi=({duration:e=500,easing:t=G})=>{uo&&n.publish("transitionEnd"),uo=!0,po=null,oo=e,ro=wt(t)?q[t]||G:t,mo=Ee,Ee=!1,n.publish("transitionStart")},yi=e=>(...t)=>{const n=e(...t);return Wn=!0,n},gi=(e,t={})=>new Promise((o=>{const r=[e.x+e.width/2,e.y+e.height/2],i=2*Math.atan(1),a=e.height*Sn>e.width?e.height/2/Math.tan(i/2):e.width/2/Math.tan(i*Sn/2);t.transition?(ln.config({isFixed:!0}),oi(r,a),n.subscribe("transitionEnd",(()=>{o(),ln.config({isFixed:!1})}),1),fi({duration:t.transitionDuration,easing:t.transitionEasing})):(ln.lookAt(r,a),n.subscribe("draw",o,1),Wn=!0)})),vi=(e,t,o={})=>new Promise((r=>{o.transition?(ln.config({isFixed:!0}),oi(e,t),n.subscribe("transitionEnd",(()=>{r(),ln.config({isFixed:!1})}),1),fi({duration:o.transitionDuration,easing:o.transitionEasing})):(ln.lookAt(e,t),n.subscribe("draw",r,1),Wn=!0)})),wi=()=>{Mn.setStyle({color:er(xt,bt,Rt),opacity:null===Ot?null:Ot[0],width:$t[0]})},xi=()=>{const e=Math.round(un)>.5?0:255;qo.initiator.style.border=`1px dashed rgba(${e}, ${e}, ${e}, 0.33)`,qo.initiator.style.background=`rgba(${e}, ${e}, ${e}, 0.1)`},bi=()=>{const e=Math.round(un)>.5?0:255;qo.longPressIndicator.style.color=`rgb(${e}, ${e}, ${e})`,qo.longPressIndicator.dataset.color=`rgb(${e}, ${e}, ${e})`;const t=w.map((e=>Math.round(255*e)));qo.longPressIndicator.dataset.activeColor=`rgb(${t[0]}, ${t[1]}, ${t[2]})`},Si=e=>{e&&ln.setView(e)},Ei=(e,t)=>n=>{if("inherit"===n)e([...t()]);else{const t=St(n)?n:[n];e(t.map((e=>Pt(e,!0))))}wi()},Ci=Ei((e=>{xt=e}),(()=>ct)),Pi=Ei((e=>{bt=e}),(()=>ut)),Mi=Ei((e=>{Rt=e}),(()=>gt)),Ai=(e={})=>{var t,o,r,i,a,s,l,c,d,h,S,I,T,O,z,k,_,Z,q,G,H,K,X,Y,U,Q,ee,te,ne,oe,re,ie,ae,se,le,ce,de,pe,he;return on(e),void 0===e.backgroundColor&&void 0===e.background||(t=e.backgroundColor||e.background)&&(p=Pt(t,!0),un=At(p),xi(),bi()),void 0!==e.backgroundImage&&((o=e.backgroundImage)?wt(o)?yt(u.regl,o).then((e=>{m=e,Wn=!0,n.publish("backgroundImageReady")})).catch((()=>{console.error(`Count not create texture from ${o}`),m=null})):m="texture2d"===o._reglType?o:null:m=null),void 0!==e.cameraTarget&&(r=e.cameraTarget)&&ln.lookAt(r,ln.distance[0],ln.rotation),void 0!==e.cameraDistance&&(i=e.cameraDistance)>0&&ln.lookAt(ln.target,i,ln.rotation),void 0!==e.cameraRotation&&null!==(a=e.cameraRotation)&&ln.lookAt(ln.target,ln.distance[0],a),void 0!==e.cameraView&&Si(e.cameraView),void 0!==e.colorBy&&(s=e.colorBy,y=rn(s,Ne)),void 0!==e.pointColor&&rr(e.pointColor),void 0!==e.pointColorActive&&ir(e.pointColorActive),void 0!==e.pointColorHover&&ar(e.pointColorHover),void 0!==e.pointSize&&(l=e.pointSize,pt(l,mt,{minLength:1})&&(Nt=[...l]),ht(+l)&&(Nt=[+l]),Xn=1/Nt[0],ao=Qo(),cr()),void 0!==e.pointSizeSelected&&(!+(c=e.pointSizeSelected)||+c<0||(jt=+c)),void 0!==e.pointSizeMouseDetection&&(d=e.pointSizeMouseDetection,_t=d,cr()),void 0!==e.sizeBy&&(e=>{Kt=rn(e,Ae)})(e.sizeBy),void 0!==e.opacity&&(h=e.opacity,pt(h,mt,{minLength:1})&&(Wt=[...h]),ht(+h)&&(Wt=[+h]),ao=Qo()),void 0!==e.showPointConnections&&(S=e.showPointConnections,vt=!!S,vt?ko(bn.points[0])&&si(Lo()).then((()=>{n.publish("pointConnectionsDraw"),Wn=!0})):si()),void 0!==e.pointConnectionColor&&Ci(e.pointConnectionColor),void 0!==e.pointConnectionColorActive&&Pi(e.pointConnectionColorActive),void 0!==e.pointConnectionColorHover&&Mi(e.pointConnectionColorHover),void 0!==e.pointConnectionColorBy&&(e=>{Tt=rn(e,Ze,{allowSegment:!0})})(e.pointConnectionColorBy),void 0!==e.pointConnectionOpacityBy&&(e=>{Lt=rn(e,Le,{allowSegment:!0})})(e.pointConnectionOpacityBy),void 0!==e.pointConnectionOpacity&&(e=>{pt(e,mt,{minLength:1})&&(Ot=[...e]),ht(+e)&&(Ot=[+e]),xt=xt.map((e=>(e[3]=Number.isNaN(+Ot[0])?e[3]:+Ot[0],e))),wi()})(e.pointConnectionOpacity),void 0!==e.pointConnectionOpacityActive&&(e=>{!Number.isNaN(+e)&&+e&&(Bt=+e)})(e.pointConnectionOpacityActive),void 0!==e.pointConnectionSize&&(I=e.pointConnectionSize,pt(I,mt,{minLength:1})&&($t=[...I]),ht(+I)&&($t=[+I]),wi()),void 0!==e.pointConnectionSizeActive&&(T=e.pointConnectionSizeActive,!Number.isNaN(+T)&&+T&&(zt=Math.max(0,T))),void 0!==e.pointConnectionSizeBy&&(e=>{Dt=rn(e,Te,{allowSegment:!0})})(e.pointConnectionSizeBy),void 0!==e.pointConnectionMaxIntPointsPerSegment&&(O=e.pointConnectionMaxIntPointsPerSegment,kt=Math.max(0,O)),void 0!==e.pointConnectionTolerance&&(z=e.pointConnectionTolerance,Ft=Math.max(0,z)),void 0!==e.opacityBy&&(e=>{Zt=rn(e,$e,{allowDensity:!0})})(e.opacityBy),void 0!==e.lassoColor&&(e=>{if(!e)return;w=Pt(e,!0),cn.setStyle({color:w});const t=w.map((e=>Math.round(255*e)));qo.longPressIndicator.dataset.activeColor=`rgb(${t[0]}, ${t[1]}, ${t[2]})`})(e.lassoColor),void 0!==e.lassoLineWidth&&(k=e.lassoLineWidth,Number.isNaN(+k)||+k<1||(x=+k,cn.setStyle({width:x}))),void 0!==e.lassoMinDelay&&+(_=e.lassoMinDelay)&&(b=+_,qo.set({minDelay:b})),void 0!==e.lassoMinDist&&+(Z=e.lassoMinDist)&&(E=+Z,qo.set({minDist:E})),void 0!==e.lassoClearEvent&&(q=e.lassoClearEvent,C=ft(J,C)(q)),void 0!==e.lassoInitiator&&(G=e.lassoInitiator,P=Boolean(G),qo.set({enableInitiator:P})),void 0!==e.lassoInitiatorParentElement&&(H=e.lassoInitiatorParentElement,M=H,qo.set({startInitiatorParentElement:M})),void 0!==e.lassoOnLongPress&&(K=e.lassoOnLongPress,A=Boolean(K)),void 0!==e.lassoLongPressTime&&(X=e.lassoLongPressTime,R=Number(X)),void 0!==e.lassoLongPressAfterEffectTime&&(Y=e.lassoLongPressAfterEffectTime,L=Number(Y)),void 0!==e.lassoLongPressEffectDelay&&(U=e.lassoLongPressEffectDelay,B=Number(U)),void 0!==e.lassoLongPressRevertEffectTime&&(e=>{$=Number(e)})(e.lassoLongPressRevertEffectTime),void 0!==e.keyMap&&(Q=e.keyMap,F=Object.entries(Q).reduce(((e,[t,n])=>(we.includes(t)&&me.includes(n)&&(e[t]=n),e)),{}),_n=Mt(F),_n[ue]?ln.config({isRotate:!0,mouseDownMoveModKey:_n[ue]}):ln.config({isRotate:!1})),void 0!==e.mouseMode&&(ee=e.mouseMode,N=ft(W,j)(ee),ln.config({defaultMouseDownMoveAction:N===V?"rotate":"pan"})),void 0!==e.showReticle&&null!==(te=e.showReticle)&&(Ee=te),void 0!==e.reticleColor&&(ne=e.reticleColor)&&(lt=Pt(ne,!0),Rn.setStyle({color:lt}),Tn.setStyle({color:lt})),void 0!==e.pointOutlineWidth&&(!+(oe=e.pointOutlineWidth)||+oe<0||(Vt=+oe)),void 0!==e.height&&(e=>{if(e===D)return Xt=e,f.style.height="100%",void window.requestAnimationFrame((()=>{f&&lr(f.getBoundingClientRect().height)}));!+e||+e<=0||(Xt=+e,lr(Xt),f.style.height=`${Xt}px`)})(e.height),void 0!==e.width&&(e=>{if(e===D)return Yt=e,f.style.width="100%",void window.requestAnimationFrame((()=>{f&&dr(f.getBoundingClientRect().width)}));!+e||+e<=0||(Yt=+e,dr(Yt),f.style.width=`${Ut}px`)})(e.width),void 0!==e.aspectRatio&&(+(re=e.aspectRatio)<=0||(jn=re)),void 0!==e.xScale&&(ie=e.xScale)&&(So=ie,Co=ie.domain()[0],Po=ie?ie.domain()[1]-ie.domain()[0]:0,So.range([0,Ut]),sr()),void 0!==e.yScale&&(ae=e.yScale)&&(Eo=ae,Mo=Eo.domain()[0],Ao=Eo?Eo.domain()[1]-Eo.domain()[0]:0,Eo.range([en,0]),sr()),void 0!==e.deselectOnDblClick&&(se=e.deselectOnDblClick,g=!!se),void 0!==e.deselectOnEscape&&(le=e.deselectOnEscape,v=!!le),void 0!==e.opacityByDensityFill&&(ce=e.opacityByDensityFill,qt=+ce),void 0!==e.opacityInactiveMax&&(de=e.opacityInactiveMax,Gt=+de),void 0!==e.opacityInactiveScale&&(pe=e.opacityInactiveScale,Ht=+pe),void 0!==e.gamma&&(he=e.gamma,u.gamma=he),new Promise((e=>{window.requestAnimationFrame((()=>{f&&(nr(),ln.refresh(),u.refresh(),Wn=!0,e())}))}))},Ii=()=>{ln||(ln=h(f,{isPanInverted:[!1,!0]})),t.cameraView?ln.setView(i(t.cameraView)):t.cameraTarget||t.cameraDistance||t.cameraRotation?ln.lookAt([...t.cameraTarget||Ke],t.cameraDistance||1,t.cameraRotation||0):ln.setView(i(Xe)),Bn=To(1,1),$n=To(-1,-1)},Ri=({key:e})=>{if("Escape"===e)v&&_o()},Ti=()=>{bo=!0,vo=!0},Oi=()=>{Wo(),bo=!1,vo=!0,Wn=!0},Li=()=>{Wn=!0},Bi=()=>{ln.refresh();const e=Yt===D,t=Xt===D;if(e||t){const{width:n,height:o}=f.getBoundingClientRect();e&&dr(n),t&&lr(o),nr(),Wn=!0}},$i=u.onFrame((()=>{yo=ln.tick(),go&&(Wn||uo)&&(uo&&!mi(oo,ro)&&hi(),yo&&(Bn=To(1,1),$n=To(-1,-1),"density"===Zt&&di()),u.render((()=>{((e,t)=>{Cn[0]=e/Sn,Cn[5]=t})(f.width/u.canvas.width,f.height/u.canvas.height),m&&m._reglType&&Jr(),Nn.length>2&&Qr(),uo||Mn.draw({projection:Mr(),model:Ir(),view:Ar()}),Hr(),pn||!Ee&&!Zn||(()=>{if(!(so>=0))return;const[e,t]=bn.points[so].slice(0,2),n=[e,t,0,1];s(o,Cn,s(o,ln.view,Pn)),d(n,n,o),Rn.setPoints([-1,n[1],1,n[1]]),Tn.setPoints([n[0],1,n[0],-1]),Rn.draw(),Tn.draw(),Gr((()=>(jt+2*Vt)*window.devicePixelRatio),(()=>1),Jn,1)(),Gr((()=>(jt+Vt)*window.devicePixelRatio),(()=>1),Jn,3)()})(),so>=0&&Kr(),yn.length&&(Xr(),Yr(),Ur()),cn.draw({projection:Mr(),model:Ir(),view:Ar()})}),f),yo&&(sr(),Vn?Vn=!1:n.publish("view",{view:ln.view,camera:ln,xScale:So,yScale:Eo})),Wn=!1,Zn=!1,n.publish("draw"))}));return(()=>{nr(),Ii(),sr(),cn=I(u.regl,{color:w,width:x,is2d:!0}),Mn=I(u.regl,{color:xt,colorHover:Rt,colorActive:bt,opacity:null===Ot?null:Ot[0],width:$t[0],widthActive:zt,is2d:!0}),Rn=I(u.regl,{color:lt,width:1,is2d:!0}),Tn=I(u.regl,{color:lt,width:1,is2d:!0}),cr(),f.addEventListener("wheel",Li),Yn=u.regl.buffer(),Un=u.regl.buffer(),Jn=u.regl.buffer({usage:"dynamic",type:"float",length:2*k}),io=tr(),ao=Qo();const e=Ai({backgroundImage:m,width:Yt,height:Xt,keyMap:F});xi(),bi(),window.addEventListener("keyup",Ri,!1),window.addEventListener("blur",Jo,!1),window.addEventListener("mouseup",Ko,!1),window.addEventListener("mousemove",Uo,!1),f.addEventListener("mousedown",Ho,!1),f.addEventListener("mouseenter",Ti,!1),f.addEventListener("mouseleave",Oi,!1),f.addEventListener("click",Xo,!1),f.addEventListener("dblclick",Yo,!1),"ResizeObserver"in window?(zn=new ResizeObserver(Bi),zn.observe(f)):(window.addEventListener("resize",Bi),window.addEventListener("orientationchange",Bi)),e.then((()=>{n.publish("init")}))})(),{get isSupported(){return u.isSupported},clear:yi((()=>{ni([]),Mn.clear()})),createTextureFromUrl:(e,t=15e3)=>yt(u.regl,e,t),deselect:_o,destroy:()=>{go=!1,dn=!0,$i(),window.removeEventListener("keyup",Ri,!1),window.removeEventListener("blur",Jo,!1),window.removeEventListener("mouseup",Ko,!1),window.removeEventListener("mousemove",Uo,!1),f.removeEventListener("mousedown",Ho,!1),f.removeEventListener("mouseenter",Ti,!1),f.removeEventListener("mouseleave",Oi,!1),f.removeEventListener("click",Xo,!1),f.removeEventListener("dblclick",Yo,!1),f.removeEventListener("wheel",Li,!1),zn?zn.disconnect():(window.removeEventListener("resize",Bi),window.removeEventListener("orientationchange",Bi)),f=void 0,ln.dispose(),ln=void 0,cn.destroy(),qo.destroy(),Mn.destroy(),Rn.destroy(),Tn.destroy(),t.renderer||u.destroy(),n.publish("destroy"),n.clear()},draw:(e,t={})=>{return dn?Promise.reject(new Error("The instance was already destroyed")):(o=e,new Promise(((e,t)=>{if(!o||Array.isArray(o))e(o);else{const n=Array.isArray(o.x)||ArrayBuffer.isView(o.x)?o.x.length:0,r=(Array.isArray(o.x)||ArrayBuffer.isView(o.x))&&(e=>o.x[e]),i=(Array.isArray(o.y)||ArrayBuffer.isView(o.y))&&(e=>o.y[e]),a=(Array.isArray(o.line)||ArrayBuffer.isView(o.line))&&(e=>o.line[e]),s=(Array.isArray(o.lineOrder)||ArrayBuffer.isView(o.lineOrder))&&(e=>o.lineOrder[e]),l=Object.keys(o),c=(()=>{const e=l.find((e=>at.has(e)));return e&&(Array.isArray(o[e])||ArrayBuffer.isView(o[e]))&&(t=>o[e][t])})(),d=(()=>{const e=l.find((e=>st.has(e)));return e&&(Array.isArray(o[e])||ArrayBuffer.isView(o[e]))&&(t=>o[e][t])})();r&&i&&c&&d&&a&&s?e(o.x.map(((e,t)=>[e,i(t),c(t),d(t),a(t),s(t)]))):r&&i&&c&&d&&a?e(Array.from({length:n},((e,t)=>[r(t),i(t),c(t),d(t),a(t)]))):r&&i&&c&&d?e(Array.from({length:n},((e,t)=>[r(t),i(t),c(t),d(t)]))):r&&i&&c?e(Array.from({length:n},((e,t)=>[r(t),i(t),c(t)]))):r&&i?e(Array.from({length:n},((e,t)=>[r(t),i(t)]))):t(new Error("You need to specify at least x and y"))}}))).then((e=>new Promise((o=>{if(dn)return void o();let r=!1;t.preventFilterReset&&e?.length===Dn||(wn=!1,xn.clear());const i=e&&ko(e[0])&&(vt||t.showPointConnectionsOnce),{zDataType:a,wDataType:s}=t;e&&(t.transition&&(e.length===Dn?r=((e,t={})=>{if(!qn)return!1;if(uo){const e=Gn;Gn=Hn,e.destroy()}else Gn=qn;return Hn=ti(e,t),Kn=u.regl.framebuffer({color:Hn,depth:!1,stencil:!1}),qn=void 0,!0})(e,{z:a,w:s}):console.warn("Cannot transition! The number of points between the previous and current draw call must be identical.")),ni(e,{z:a,w:s}),void 0!==t.hover&&Wo(t.hover,{preventEvent:!0}),void 0!==t.select&&Vo(t.select,{preventEvent:!0}),void 0!==t.filter&&li(t.filter,{preventEvent:!0}),i&&si(e).then((()=>{n.publish("pointConnectionsDraw"),Wn=!0,Zn=t.showReticleOnce}))),t.transition&&r?(i?Promise.all([new Promise((e=>{n.subscribe("transitionEnd",(()=>{Wn=!0,Zn=t.showReticleOnce,e()}),1)})),new Promise((e=>{n.subscribe("pointConnectionsDraw",e,1)}))]).then(o):n.subscribe("transitionEnd",(()=>{Wn=!0,Zn=t.showReticleOnce,o()}),1),fi({duration:t.transitionDuration,easing:t.transitionEasing})):(i?Promise.all([new Promise((e=>{n.subscribe("draw",e,1)})),new Promise((e=>{n.subscribe("pointConnectionsDraw",e,1)}))]).then(o):n.subscribe("draw",o,1),Wn=!0,Zn=t.showReticleOnce)}))));var o},filter:li,get:e=>(on({property:!0}),"aspectRatio"===e?jn:"background"===e||"backgroundColor"===e?p:"backgroundImage"===e?m:"camera"===e?ln:"cameraTarget"===e?ln.target:"cameraDistance"===e?ln.distance[0]:"cameraRotation"===e?ln.rotation:"cameraView"===e?ln.view:"canvas"===e?f:"colorBy"===e?y:"sizeBy"===e?Kt:"deselectOnDblClick"===e?g:"deselectOnEscape"===e?v:"height"===e?Xt:"lassoColor"===e?w:"lassoLineWidth"===e?x:"lassoMinDelay"===e?b:"lassoMinDist"===e?E:"lassoClearEvent"===e?C:"lassoInitiator"===e?P:"lassoInitiatorElement"===e?qo.initiator:"lassoInitiatorParentElement"===e?M:"keyMap"===e?{...F}:"mouseMode"===e?N:"opacity"===e?1===Wt.length?Wt[0]:Wt:"opacityBy"===e?Zt:"opacityByDensityFill"===e?qt:"opacityByDensityDebounceTime"===e?sn:"opacityInactiveMax"===e?Gt:"opacityInactiveScale"===e?Ht:"points"===e?bn.points:"hoveredPoint"===e?so:"selectedPoints"===e?[...yn]:"filteredPoints"===e?wn?Array.from(xn):Array.from({length:bn.points.length},((e,t)=>t)):"pointsInView"===e?ci():"pointColor"===e?1===ct.length?ct[0]:ct:"pointColorActive"===e?1===ut.length?ut[0]:ut:"pointColorHover"===e?1===gt.length?gt[0]:gt:"pointOutlineWidth"===e?Vt:"pointSize"===e?1===Nt.length?Nt[0]:Nt:"pointSizeSelected"===e?jt:"pointSizeMouseDetection"===e?_t:"showPointConnections"===e?vt:"pointConnectionColor"===e?1===xt.length?xt[0]:xt:"pointConnectionColorActive"===e?1===bt.length?bt[0]:bt:"pointConnectionColorHover"===e?1===Rt.length?Rt[0]:Rt:"pointConnectionColorBy"===e?Tt:"pointConnectionOpacity"===e?1===Ot.length?Ot[0]:Ot:"pointConnectionOpacityBy"===e?Lt:"pointConnectionOpacityActive"===e?Bt:"pointConnectionSize"===e?1===$t.length?$t[0]:$t:"pointConnectionSizeActive"===e?zt:"pointConnectionSizeBy"===e?Dt:"pointConnectionMaxIntPointsPerSegment"===e?kt:"pointConnectionTolerance"===e?Ft:"reticleColor"===e?lt:"regl"===e?u.regl:"showReticle"===e?Ee:"version"===e?"1.7.1":"width"===e?Yt:"xScale"===e?So:"yScale"===e?Eo:"performanceMode"===e?nn:"gamma"===e?u.gamma:"renderer"===e?u:"isDestroyed"===e?dn:"isPointsDrawn"===e?go:"isPointsFiltered"===e?wn:"zDataType"===e?wo:"wDataType"===e?xo:void 0),hover:Wo,redraw:()=>{Wn=!0},refresh:u.refresh,reset:yi((({preventEvent:e=!1}={})=>{Ii(),sr(),e||n.publish("view",{view:ln.view,camera:ln,xScale:So,yScale:Eo})})),select:Vo,set:Ai,export:()=>f.getContext("2d").getImageData(0,0,f.width,f.height),subscribe:n.subscribe,unfilter:({preventEvent:e=!1}={})=>(wn=!1,xn.clear(),Yn.subdata(ei(Dn)),new Promise((t=>{const o=()=>{n.subscribe("draw",(()=>{e||n.publish("unfilter"),t()}),1),Wn=!0};vt||ko(bn.points[0])?si(Lo()).then((()=>{e||n.publish("pointConnectionsDraw"),o()})):o()}))),unsubscribe:n.unsubscribe,view:(e,{preventEvent:t=!1}={})=>{Si(e),Wn=!0,Vn=t},zoomToLocation:vi,zoomToArea:gi,zoomToPoints:(e,t={})=>{if(!go)return Promise.reject(new Error("Points have not been drawn"));const n=(e=>{let t=1/0,n=-1/0,o=1/0,r=-1/0;for(let i=0;i<e.length;i++){const[a,s]=bn.points[e[i]];t=Math.min(t,a),n=Math.max(n,a),o=Math.min(o,s),r=Math.max(r,s)}return{x:t,y:o,width:n-t,height:r-o}})(e),o=n.x+n.width/2,r=n.y+n.height/2,i=Oo(),a=1+(t.padding||0),s=Math.max(n.width,i)*a,l=Math.max(n.height,i)*a;return gi({x:o-s/2,y:r-l/2,width:s,height:l},t)},zoomToOrigin:(e={})=>vi([0,0],1,e)}};export{lt as checkSupport,ct as createRegl,It as createRenderer,yt as createTextureFromUrl,sn as default};
